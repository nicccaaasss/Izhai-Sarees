<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Izhai - Draped in Elegance</title>
    <meta name="description" content="Discover handcrafted sarees and kurtis at Izhai - premium Indian ethnic wear">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=Inter:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="home.css">
    <style>
        /* ============================================
   CATEGORY SCREEN IMPROVEMENTS - LAPTOP VIEW
   ============================================ */

        /* Improved Bento Grid Layout for Desktop */
        @media (min-width: 1024px) {
            .bento-grid {
                grid-template-columns: repeat(6, 1fr);
                grid-template-rows: repeat(3, 200px);
                gap: 20px;
                padding: 40px 60px 120px;
                max-width: 1600px;
            }

            /* Hero Item - Takes up 2x2 space */
            .bento-item-hero {
                grid-column: span 3;
                grid-row: span 2;
                height: auto;
                padding: 32px;
            }

            .bento-item-hero .bento-title {
                font-size: 42px;
            }

            .bento-item-hero .bento-subtitle {
                font-size: 16px;
            }

            /* Standard Items - Better proportions */
            .bento-item-standard {
                grid-column: span 3;
                grid-row: span 1;
                height: auto;
                padding: 24px;
            }

            .bento-item-standard .bento-title {
                font-size: 24px;
            }

            .bento-item-standard .bento-subtitle {
                font-size: 14px;
            }

            /* Wide Item - Spans 2 columns */
            .bento-item-standard.wide {
                grid-column: span 6;
                grid-row: span 1;
            }

            .bento-item-standard.wide .bento-title {
                font-size: 28px;
            }

            /* Smooth hover effects */
            .glass-card {
                transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
            }

            .glass-card:hover {
                transform: translateY(-12px) scale(1.02);
                box-shadow: 0 30px 60px rgba(124, 77, 255, 0.2);
                border-color: rgba(124, 77, 255, 0.3);
            }

            .glass-card:hover .bento-overlay {
                background: linear-gradient(to top, rgba(124, 77, 255, 0.4) 0%, rgba(0, 0, 0, 0) 60%);
            }
        }

        /* Extra large screens - 4 column layout */
        @media (min-width: 1440px) {
            .bento-grid {
                grid-template-columns: repeat(8, 1fr);
                grid-template-rows: repeat(3, 220px);
                gap: 24px;
                padding: 60px 80px 140px;
            }

            .bento-item-hero {
                grid-column: span 4;
                grid-row: span 2;
            }

            .bento-item-standard {
                grid-column: span 2;
                grid-row: span 1;
            }

            .bento-item-standard.wide {
                grid-column: span 4;
            }
        }

        /* ============================================
   CATEGORY DETAIL SCREEN - SEARCH BAR ON TOP
   ============================================ */

        @media (min-width: 1024px) {

            /* Move header to top and make it full-width */
            .category-header {
                position: sticky;
                top: 0;
                z-index: 200;
                width: 100%;
                padding: 20px 60px;
                background: rgba(255, 255, 255, 0.98);
                backdrop-filter: blur(30px);
                border-bottom: 1px solid rgba(0, 0, 0, 0.08);
                display: flex;
                align-items: center;
                gap: 24px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.03);
            }

            /* Back button */
            .category-header .icon-btn:first-child {
                margin-right: 0;
                flex-shrink: 0;
            }

            /* Category title */
            #categoryDetailTitle {
                font-size: 28px;
                flex-shrink: 0;
                margin-right: auto;
            }

            /* Search button - expand to search bar on click */
            .category-header .icon-btn:last-child {
                flex-shrink: 0;
                width: auto;
                max-width: 400px;
                flex: 1;
                height: 48px;
                border-radius: 24px;
                background: rgba(124, 77, 255, 0.08);
                border: 2px solid transparent;
                padding: 0 20px;
                transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1);
                position: relative;
                overflow: hidden;
            }

            .category-header .icon-btn:last-child svg {
                position: absolute;
                left: 16px;
                top: 50%;
                transform: translateY(-50%);
            }

            .category-header .icon-btn:last-child::after {
                content: 'Search in this category...';
                position: absolute;
                left: 50px;
                top: 50%;
                transform: translateY(-50%);
                font-size: 15px;
                color: var(--text-secondary);
                font-weight: 500;
                opacity: 0.6;
            }

            .category-header .icon-btn:last-child:hover {
                background: rgba(124, 77, 255, 0.12);
                border-color: var(--purple-500);
                transform: scale(1.02);
            }

            .category-header .icon-btn:last-child:focus {
                background: white;
                border-color: var(--purple-500);
                box-shadow: 0 0 0 4px rgba(124, 77, 255, 0.1);
            }

            /* Product grid spacing adjustment */
            #categoryDetailGrid {
                padding: 40px 60px 120px;
            }
        }

        /* Ultra-wide screens */
        @media (min-width: 1920px) {
            .category-header {
                padding: 24px 100px;
            }

            #categoryDetailGrid {
                padding: 60px 100px 140px;
                max-width: 2000px;
                margin: 0 auto;
            }
        }

        /* Smooth transitions for layout changes */
        .bento-item,
        .glass-card {
            will-change: transform;
        }

        .category-header {
            will-change: transform, background-color;
        }

        /* ============================================
   CATEGORY DETAIL SCREEN - FIXED LAYOUT
   ============================================ */

        /* Hide the old floating search bar on desktop */
        @media (min-width: 1024px) {
            #categoryDetailScreen .category-header {
                position: sticky;
                top: 0;
                z-index: 200;
                width: 100%;
                padding: 16px 60px;
                background: rgba(255, 255, 255, 0.98);
                backdrop-filter: blur(30px);
                -webkit-backdrop-filter: blur(30px);
                border-bottom: 1px solid rgba(0, 0, 0, 0.08);
                display: grid;
                grid-template-columns: auto auto 1fr auto;
                align-items: center;
                gap: 20px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.03);
            }

            /* Back button styling */
            .category-header .icon-btn:first-child {
                margin-right: 0;
                grid-column: 1;
            }

            /* Title styling */
            #categoryDetailTitle {
                font-size: 24px;
                white-space: nowrap;
                grid-column: 2;
                margin: 0;
            }

            /* Search bar container - make it expand */
            .category-header .icon-btn:last-child {
                grid-column: 3;
                width: 100%;
                max-width: 500px;
                height: 44px;
                border-radius: 22px;
                background: rgba(124, 77, 255, 0.06);
                border: 1px solid rgba(124, 77, 255, 0.15);
                padding: 0 16px 0 44px;
                display: flex;
                align-items: center;
                position: relative;
                transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1);
                justify-self: end;
            }

            .category-header .icon-btn:last-child svg {
                position: absolute;
                left: 14px;
                top: 50%;
                transform: translateY(-50%);
                width: 20px;
                height: 20px;
                stroke: var(--purple-500);
            }

            /* Add search placeholder text */
            .category-header .icon-btn:last-child::after {
                content: 'Search in this category...';
                font-size: 14px;
                color: var(--text-secondary);
                font-weight: 400;
                white-space: nowrap;
            }

            .category-header .icon-btn:last-child:hover {
                background: rgba(124, 77, 255, 0.1);
                border-color: var(--purple-500);
                box-shadow: 0 2px 8px rgba(124, 77, 255, 0.15);
            }

            /* Product grid - proper spacing below header */
            #categoryDetailScreen #categoryDetailGrid {
                padding: 32px 60px 120px;
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
                gap: 24px;
            }
        }

        /* Large desktop optimization */
        @media (min-width: 1440px) {
            #categoryDetailScreen .category-header {
                padding: 20px 80px;
                gap: 32px;
            }

            #categoryDetailTitle {
                font-size: 28px;
            }

            .category-header .icon-btn:last-child {
                max-width: 600px;
                height: 48px;
                padding: 0 20px 0 52px;
            }

            .category-header .icon-btn:last-child svg {
                left: 18px;
                width: 22px;
                height: 22px;
            }

            .category-header .icon-btn:last-child::after {
                font-size: 15px;
            }

            #categoryDetailScreen #categoryDetailGrid {
                padding: 40px 80px 140px;
                grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
                gap: 32px;
                max-width: 1800px;
                margin: 0 auto;
            }
        }

        /* Extra large screens */
        @media (min-width: 1920px) {
            #categoryDetailScreen .category-header {
                padding: 24px 120px;
            }

            #categoryDetailScreen #categoryDetailGrid {
                padding: 60px 120px 160px;
                max-width: 2200px;
            }
        }

        /* Ensure smooth transitions */
        .category-header {
            transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1);
        }

        #categoryDetailGrid {
            transition: padding 0.3s ease;
        }

        /* ============================================
   CATEGORY DETAIL SCREEN - COMPLETE FIX
   ============================================ */

        /* Ensure the header is visible and properly styled */
        @media (min-width: 1024px) {

            /* Category Detail Screen Container */
            #categoryDetailScreen {
                display: block;
                padding-top: 0;
            }

            /* Sticky Header with Back Button, Title, and Search */
            #categoryDetailScreen .category-header,
            #categoryDetailScreen .app-header.category-header {
                position: sticky;
                top: 0;
                z-index: 200;
                width: 100%;
                height: auto;
                padding: 20px 60px;
                background: rgba(255, 255, 255, 0.98);
                backdrop-filter: blur(30px);
                -webkit-backdrop-filter: blur(30px);
                border-bottom: 1px solid rgba(0, 0, 0, 0.08);
                display: flex;
                align-items: center;
                gap: 24px;
                box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
                margin-bottom: 0;
            }

            /* Back Button */
            .category-header .icon-btn:first-child {
                flex-shrink: 0;
                width: 44px;
                height: 44px;
                margin-right: 0;
                background: rgba(0, 0, 0, 0.03);
                border-radius: 50%;
                transition: all 0.3s ease;
            }

            .category-header .icon-btn:first-child:hover {
                background: rgba(124, 77, 255, 0.1);
                transform: scale(1.05);
            }

            /* Category Title */
            #categoryDetailTitle {
                font-family: 'Playfair Display', serif;
                font-size: 28px;
                font-weight: 700;
                color: var(--purple-900);
                margin: 0;
                flex-shrink: 0;
            }

            /* Spacer to push search to the right */
            .category-header>div[style*="flex:1"],
            .category-header>div:nth-child(3) {
                flex: 1;
            }

            /* Search Button - Styled as Search Bar */
            .category-header .icon-btn:last-child {
                flex-shrink: 0;
                width: auto;
                min-width: 400px;
                max-width: 500px;
                height: 48px;
                border-radius: 24px;
                background: rgba(124, 77, 255, 0.06);
                border: 1.5px solid rgba(124, 77, 255, 0.15);
                padding: 0 20px 0 52px;
                display: flex;
                align-items: center;
                position: relative;
                transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1);
                cursor: pointer;
            }

            /* Search Icon */
            .category-header .icon-btn:last-child svg {
                position: absolute;
                left: 16px;
                top: 50%;
                transform: translateY(-50%);
                width: 22px;
                height: 22px;
                stroke: var(--purple-500);
                stroke-width: 2;
            }

            /* Search Placeholder Text */
            .category-header .icon-btn:last-child::after {
                content: 'Search in this category...';
                font-size: 15px;
                color: var(--text-secondary);
                font-weight: 400;
                white-space: nowrap;
            }

            /* Search Button Hover */
            .category-header .icon-btn:last-child:hover {
                background: rgba(124, 77, 255, 0.1);
                border-color: var(--purple-400);
                box-shadow: 0 4px 12px rgba(124, 77, 255, 0.15);
                transform: translateY(-1px);
            }

            /* Search Button Active/Focus */
            .category-header .icon-btn:last-child:active {
                background: white;
                border-color: var(--purple-500);
                box-shadow: 0 0 0 4px rgba(124, 77, 255, 0.1);
                transform: scale(0.98);
            }

            /* Product Grid - Proper spacing */
            #categoryDetailScreen #categoryDetailGrid {
                padding: 40px 60px 120px;
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
                gap: 28px;
            }

            /* Product Cards - Better sizing */
            #categoryDetailGrid .product-card {
                max-width: 100%;
                margin: 0;
            }
        }

        /* Large Desktop (1440px+) */
        @media (min-width: 1440px) {
            .category-header {
                padding: 24px 80px;
                gap: 32px;
            }

            #categoryDetailTitle {
                font-size: 32px;
            }

            .category-header .icon-btn:last-child {
                min-width: 500px;
                max-width: 600px;
                height: 52px;
                padding: 0 24px 0 56px;
            }

            .category-header .icon-btn:last-child svg {
                left: 20px;
                width: 24px;
                height: 24px;
            }

            .category-header .icon-btn:last-child::after {
                font-size: 16px;
            }

            #categoryDetailScreen #categoryDetailGrid {
                padding: 50px 80px 140px;
                grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
                gap: 32px;
                max-width: 1800px;
                margin: 0 auto;
            }
        }

        /* Extra Large Screens (1920px+) */
        @media (min-width: 1920px) {
            .category-header {
                padding: 28px 120px;
            }

            #categoryDetailScreen #categoryDetailGrid {
                padding: 60px 120px 160px;
                max-width: 2200px;
                grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
                gap: 40px;
            }
        }

        /* Ensure proper stacking context */
        #categoryDetailScreen {
            position: relative;
            z-index: 0;
        }

        .category-header {
            position: sticky;
            top: 0;
            z-index: 100;
        }

        /* Smooth scroll behavior */
        #categoryDetailScreen {
            scroll-behavior: smooth;
        }

        /* ============================================
   CATEGORY DETAIL SCREEN - MOBILE LAYOUT FIX
   Make it look like desktop with header on top
   ============================================ */

        /* Mobile: Header at the top (same as desktop) */
        @media (max-width: 1023px) {
            #categoryDetailScreen {
                display: flex;
                flex-direction: column;
                height: 100vh;
                overflow: hidden;
            }

            /* Sticky Header at Top */
            #categoryDetailScreen .category-header,
            #categoryDetailScreen .app-header.category-header {
                position: sticky;
                top: 0;
                z-index: 200;
                width: 100%;
                padding: 16px 20px;
                background: rgba(255, 255, 255, 0.98);
                backdrop-filter: blur(30px);
                -webkit-backdrop-filter: blur(30px);
                border-bottom: 1px solid rgba(0, 0, 0, 0.08);
                display: flex;
                align-items: center;
                gap: 16px;
                box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
                flex-shrink: 0;
            }

            /* Back Button */
            .category-header .icon-btn:first-child {
                flex-shrink: 0;
                width: 40px;
                height: 40px;
                margin: 0;
                background: rgba(0, 0, 0, 0.04);
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .category-header .icon-btn:first-child svg {
                width: 20px;
                height: 20px;
                stroke-width: 2.5;
            }

            /* Category Title */
            #categoryDetailTitle {
                font-family: 'Playfair Display', serif;
                font-size: 20px;
                font-weight: 700;
                color: var(--purple-900);
                margin: 0;
                flex: 1;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            /* Search Button */
            .category-header .icon-btn:last-child {
                flex-shrink: 0;
                width: 40px;
                height: 40px;
                background: rgba(124, 77, 255, 0.08);
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                border: 1px solid rgba(124, 77, 255, 0.15);
            }

            .category-header .icon-btn:last-child svg {
                width: 20px;
                height: 20px;
                stroke: var(--purple-600);
                position: static;
                transform: none;
            }

            /* Hide desktop search placeholder on mobile */
            .category-header .icon-btn:last-child::after {
                display: none;
            }

            /* Scrollable Product Grid Container */
            #categoryDetailScreen>div:last-child {
                flex: 1;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }

            /* Product Grid */
            #categoryDetailScreen #categoryDetailGrid {
                padding: 20px 16px 100px;
                grid-template-columns: repeat(2, 1fr);
                gap: 16px;
            }

            /* Product Cards - Better mobile sizing */
            #categoryDetailGrid .product-card {
                border-radius: var(--radius-lg);
                overflow: hidden;
            }

            #categoryDetailGrid .product-img {
                aspect-ratio: 3/4;
            }

            #categoryDetailGrid .product-name {
                font-size: 14px;
                line-height: 1.3;
            }

            #categoryDetailGrid .product-price {
                font-size: 15px;
            }

            #categoryDetailGrid .product-original-price {
                font-size: 12px;
            }
        }

        /* Small phones (under 375px) */
        @media (max-width: 374px) {
            #categoryDetailTitle {
                font-size: 18px;
            }

            .category-header .icon-btn:first-child,
            .category-header .icon-btn:last-child {
                width: 36px;
                height: 36px;
            }

            #categoryDetailScreen #categoryDetailGrid {
                padding: 16px 12px 100px;
                gap: 12px;
            }
        }

        /* Tablets (768px - 1023px) */
        @media (min-width: 768px) and (max-width: 1023px) {
            .category-header {
                padding: 20px 32px;
                gap: 20px;
            }

            #categoryDetailTitle {
                font-size: 24px;
            }

            .category-header .icon-btn:first-child,
            .category-header .icon-btn:last-child {
                width: 44px;
                height: 44px;
            }

            .category-header .icon-btn svg {
                width: 22px;
                height: 22px;
            }

            #categoryDetailScreen #categoryDetailGrid {
                padding: 32px 32px 120px;
                grid-template-columns: repeat(3, 1fr);
                gap: 20px;
            }

            #categoryDetailGrid .product-name {
                font-size: 15px;
            }

            #categoryDetailGrid .product-price {
                font-size: 16px;
            }
        }

        /* Fix for safe area on notched devices */
        @supports (padding: max(0px)) {
            .category-header {
                padding-left: max(20px, env(safe-area-inset-left));
                padding-right: max(20px, env(safe-area-inset-right));
                padding-top: max(16px, env(safe-area-inset-top));
            }
        }

        /* Smooth scrolling */
        #categoryDetailScreen>div:last-child {
            scroll-behavior: smooth;
        }

        /* Better touch feedback */
        @media (max-width: 1023px) {
            .category-header .icon-btn:active {
                transform: scale(0.9);
                background: rgba(124, 77, 255, 0.15);
            }

            #categoryDetailGrid .product-card:active {
                transform: scale(0.97);
            }
        }

        /* Loading state skeleton (optional) */
        .category-grid-loading {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            padding: 20px 16px;
        }

        .skeleton-card {
            background: linear-gradient(90deg, #f0f0f5 25%, #e8e8f0 50%, #f0f0f5 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: var(--radius-lg);
            height: 300px;
        }

        @media (min-width: 768px) and (max-width: 1023px) {
            .category-grid-loading {
                grid-template-columns: repeat(3, 1fr);
                gap: 20px;
                padding: 32px;
            }
        }

        /* Pull-to-refresh indicator space (for native feel) */
        #categoryDetailScreen>div:last-child::before {
            content: '';
            display: block;
            height: 20px;
        }

        /* Bottom nav spacing */
        @media (max-width: 1023px) {
            #categoryDetailScreen #categoryDetailGrid {
                padding-bottom: calc(var(--bottom-nav-height) + 32px);
            }
        }

        /* Hide any desktop-only elements on mobile */
        @media (max-width: 1023px) {
            .category-header .icon-btn:last-child {
                min-width: unset;
                max-width: unset;
                width: 40px;
                padding: 0;
                border-radius: 50%;
            }
        }

        /* Animated Search Button on Mobile */
        @media (max-width: 1023px) {
            .category-header .icon-btn:last-child {
                position: relative;
                overflow: visible;
            }

            /* Ripple effect on tap */
            .category-header .icon-btn:last-child::before {
                content: '';
                position: absolute;
                inset: -4px;
                border-radius: 50%;
                border: 2px solid var(--purple-500);
                opacity: 0;
                animation: searchPulse 1.5s ease-out infinite;
            }

            @keyframes searchPulse {
                0% {
                    transform: scale(0.8);
                    opacity: 0.8;
                }

                50% {
                    transform: scale(1.2);
                    opacity: 0.3;
                }

                100% {
                    transform: scale(1.5);
                    opacity: 0;
                }
            }

            /* Active state */
            .category-header .icon-btn:last-child:active::before {
                animation: none;
                opacity: 0;
            }
        }

        /* Premium Header Gradient (Mobile) */
        @media (max-width: 1023px) {
            .category-header::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 1px;
                background: linear-gradient(90deg,
                        transparent,
                        rgba(124, 77, 255, 0.3) 20%,
                        rgba(124, 77, 255, 0.5) 50%,
                        rgba(124, 77, 255, 0.3) 80%,
                        transparent);
            }
        }

        /* ============================================
   FIX MOBILE VIEW - REMOVE BOX SPACE & SHOW PRICES
   ============================================ */

        @media (max-width: 1023px) {

            /* Remove any unwanted spacing/boxes */
            #categoryDetailScreen {
                padding: 0;
                margin: 0;
                background: var(--bg-primary);
            }

            /* Ensure header has no extra space */
            .category-header {
                margin: 0;
                padding: 16px 20px;
            }

            /* Fix product card to show full content */
            #categoryDetailGrid .product-card {
                display: flex;
                flex-direction: column;
                background: var(--bg-secondary);
                border-radius: var(--radius-lg);
                overflow: hidden;
                box-shadow: var(--shadow-sm);
                height: auto;
                /* Allow natural height */
            }

            /* Product image - proper aspect ratio */
            #categoryDetailGrid .product-img {
                position: relative;
                aspect-ratio: 3/4;
                width: 100%;
                overflow: hidden;
                flex-shrink: 0;
            }

            #categoryDetailGrid .product-img img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }

            /* Product info - always visible, scrollable if needed */
            #categoryDetailGrid .product-info {
                padding: 12px;
                display: flex;
                flex-direction: column;
                gap: 6px;
                flex: 1;
                min-height: fit-content;
            }

            /* Product name - wrap if long */
            #categoryDetailGrid .product-name {
                font-size: 13px;
                font-weight: 600;
                line-height: 1.3;
                color: var(--text-primary);
                display: -webkit-box;
                -webkit-line-clamp: 2;
                line-clamp: 2;
                -webkit-box-orient: vertical;
                overflow: hidden;
                word-wrap: break-word;
            }

            /* Product price - always visible */
            #categoryDetailGrid .product-price {
                font-size: 15px;
                font-weight: 700;
                color: var(--purple-600);
                display: flex;
                align-items: baseline;
                gap: 6px;
                flex-wrap: wrap;
            }

            #categoryDetailGrid .product-original-price {
                font-size: 12px;
                color: var(--text-muted);
                text-decoration: line-through;
            }

            /* Grid container - proper scrolling */
            #categoryDetailScreen #categoryDetailGrid {
                padding: 20px 16px calc(var(--bottom-nav-height) + 32px);
                grid-template-columns: repeat(2, 1fr);
                gap: 16px;
                min-height: 0;
                /* Important for proper scrolling */
            }

            /* Remove any conflicting overflow settings */
            #categoryDetailScreen>div:last-child {
                overflow-y: auto;
                overflow-x: hidden;
                -webkit-overflow-scrolling: touch;
            }
        }

        /* Tablets - 3 column grid with more space */
        @media (min-width: 768px) and (max-width: 1023px) {
            #categoryDetailGrid .product-card {
                height: auto;
            }

            #categoryDetailGrid .product-name {
                font-size: 14px;
                -webkit-line-clamp: 2;
                line-clamp: 2;
            }

            #categoryDetailGrid .product-price {
                font-size: 16px;
            }

            #categoryDetailGrid .product-original-price {
                font-size: 13px;
            }

            #categoryDetailScreen #categoryDetailGrid {
                padding: 32px calc(var(--bottom-nav-height) + 40px);
                grid-template-columns: repeat(3, 1fr);
                gap: 20px;
            }
        }
    </style>
</head>

<body>
    <!-- Royal Purple Animated Background -->
    <div class="royal-bg">
        <div class="gradient-orbs">
            <div class="orb orb-1"></div>
            <div class="orb orb-2"></div>
            <div class="orb orb-3"></div>
        </div>
        <div class="particles" id="particles"></div>
    </div>
    <div id="intro" class="screen active">
        <div class="intro-bg"></div>
        <svg class="intro-threads" viewBox="0 0 100 100" preserveAspectRatio="none">
            <defs>
                <linearGradient id="threadGrad" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" stop-color="#d4af37" stop-opacity="0" />
                    <stop offset="50%" stop-color="#d4af37" />
                    <stop offset="100%" stop-color="#d4af37" stop-opacity="0" />
                </linearGradient>
            </defs>
            <path class="thread-path" d="M0,20 Q25,25 50,20 T100,20" style="animation-delay:0s" />
            <path class="thread-path" d="M0,50 Q25,45 50,50 T100,50" style="animation-delay:0.3s" />
            <path class="thread-path" d="M0,80 Q25,75 50,80 T100,80" style="animation-delay:0.6s" />
        </svg>
        <div class="logo-container">
            <div class="logo-text">
                <span class="logo-letter">I</span>
                <span class="logo-letter">z</span>
                <span class="logo-letter">h</span>
                <span class="logo-letter">a</span>
                <span class="logo-letter">i</span>
            </div>
            <p class="tagline">Draped in Elegance</p>
            <div class="intro-ornament"></div>
        </div>
        <div class="butterfly">
            <svg viewBox="0 0 40 40" fill="none">
                <path d="M20,20 Q15,10 10,15 Q5,20 10,25 Q15,30 20,20 Z" fill="#d4af37" opacity="0.8" />
                <path d="M20,20 Q25,10 30,15 Q35,20 30,25 Q25,30 20,20 Z" fill="#b8860b" opacity="0.8" />
                <circle cx="20" cy="20" r="2" fill="#4a2c6f" />
            </svg>
        </div>
    </div>
    <div id="gateway" class="screen">
        <div class="gateway-content">
            <div class="gateway-icon">
                <svg viewBox="0 0 24 24" fill="none">
                    <path
                        d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"
                        stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </div>
            <h1 class="gateway-title heading">Welcome to Izhai</h1>
            <p class="gateway-subtitle">Discover timeless elegance with our handcrafted collection of sarees and kurtis
            </p>
            <button class="btn btn-primary ripple" onclick="App.showAuth()">Explore Collection</button>
        </div>
    </div>
    <div id="auth" class="screen">
        <div class="auth-container">
            <div class="auth-card">
                <div class="auth-header">
                    <div class="auth-logo">Izhai</div>
                </div>
                <div class="auth-tabs">
                    <button class="auth-tab active" data-tab="login">Sign In</button>
                    <button class="auth-tab" data-tab="signup">Sign Up</button>
                </div>
                <form id="loginForm" onsubmit="App.handleAuth(event)">
                    <div class="form-group">
                        <input type="text" class="form-input" placeholder=" " required>
                        <label class="form-label">Email or Username</label>
                    </div>
                    <div class="form-group" style="position:relative">
                        <input type="password" id="loginPass" class="form-input" placeholder=" " required>
                        <label class="form-label">Password</label>
                        <button type="button" onclick="App.togglePassword('loginPass')"
                            style="position:absolute; right:10px; top:50%; transform:translateY(-50%); background:none; border:none; cursor:pointer; color:var(--text-secondary)">
                            <svg viewBox="0 0 24 24" width="20" height="20" stroke="currentColor" fill="none"
                                class="eye-icon">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                        </button>
                    </div>
                    <button type="submit" class="form-btn ripple">Continue</button>
                </form>
                <form id="signupForm" class="hidden" onsubmit="App.handleAuth(event)">
                    <div class="form-group">
                        <input type="text" class="form-input" placeholder=" " required>
                        <label class="form-label">Full Name</label>
                    </div>
                    <div class="form-group">
                        <input type="email" class="form-input" placeholder=" " required>
                        <label class="form-label">Email</label>
                    </div>
                    <div class="form-group">
                        <input type="tel" class="form-input" placeholder=" " required>
                        <label class="form-label">Phone</label>
                    </div>
                    <div class="form-group" style="position:relative">
                        <input type="password" id="signupPass" class="form-input" placeholder=" " required>
                        <label class="form-label">Password</label>
                        <button type="button" onclick="App.togglePassword('signupPass')"
                            style="position:absolute; right:10px; top:50%; transform:translateY(-50%); background:none; border:none; cursor:pointer; color:var(--text-secondary)">
                            <svg viewBox="0 0 24 24" width="20" height="20" stroke="currentColor" fill="none"
                                class="eye-icon">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                        </button>
                    </div>
                    <button type="submit" class="form-btn ripple">Create Account</button>
                </form>
                <div class="auth-divider">or</div>
                <button class="guest-btn" onclick="App.enterApp()">Continue as Guest</button>
            </div>
        </div>
    </div>
    <div id="app" class="screen">
        <header class="app-header">
            <div class="header-logo">Izhai</div>
            <div class="header-actions">
                <button class="icon-btn" onclick="App.toggleContact()" aria-label="Contact">
                    <svg viewBox="0 0 24 24" stroke-width="2" fill="none" stroke="currentColor">
                        <path
                            d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z">
                        </path>
                    </svg>
                </button>
                <button class="icon-btn" onclick="App.toggleSearch()">
                    <svg viewBox="0 0 24 24">
                        <circle cx="11" cy="11" r="8" />
                        <path d="m21 21-4.35-4.35" />
                    </svg>
                </button>
                <button class="icon-btn" onclick="App.toggleCart()">
                    <svg viewBox="0 0 24 24">
                        <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z" />
                        <line x1="3" y1="6" x2="21" y2="6" />
                        <path d="M16 10a4 4 0 0 1-8 0" />
                    </svg>
                    <span class="badge" id="cartBadge">0</span>
                </button>
            </div>
        </header>
        <main>
            <section class="hero">
                <div class="hero-content">
                    <h1 class="hero-title heading">Timeless Elegance</h1>
                    <p class="hero-subtitle">Discover handcrafted sarees & kurtis woven with tradition and love</p>
                </div>

                <div class="hero-slider" id="heroSlider" onmouseenter="App.stopAutoplay()"
                    onmouseleave="App.startAutoplay()">
                    <!-- Progress Loader -->
                    <div class="slide-loader"></div>

                    <!-- Slide 1 -->
                    <div class="slide active"
                        style="background-image: url('https://images.unsplash.com/photo-1610030469983-98e550d6193c?auto=format&fit=crop&q=80&w=1200')">
                        <div class="slide-content glass-content">
                            <div class="accent-line"></div>
                            <h2 class="slide-title">Festive Collection</h2>
                            <p class="slide-subtitle">Elegant Silk Sarees at 30% Off</p>
                            <button class="slide-btn" onclick="App.openCategory('silk')">
                                <span>Shop Silk</span>
                                <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M5 12h14M12 5l7 7-7 7" />
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- Slide 2 -->
                    <div class="slide"
                        style="background-image: url('https://images.unsplash.com/photo-1617627143750-d86bc21e42bb?auto=format&fit=crop&q=80&w=1200')">
                        <div class="slide-content glass-content">
                            <div class="accent-line"></div>
                            <h2 class="slide-title">Bridal Special</h2>
                            <p class="slide-subtitle">Handwoven Masterpieces for Your Big Day</p>
                            <button class="slide-btn" onclick="App.openCategory('wedding')">
                                <span>View Bridal</span>
                                <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M5 12h14M12 5l7 7-7 7" />
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- Navigation Arrows -->
                    <button class="slider-nav-btn prev" onclick="App.prevSlide()" aria-label="Previous Slide">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                            stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="15 18 9 12 15 6" />
                        </svg>
                    </button>
                    <button class="slider-nav-btn next" onclick="App.nextSlide()" aria-label="Next Slide">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                            stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="9 18 15 12 9 6" />
                        </svg>
                    </button>

                    <!-- Dots Container -->
                    <div class="slider-dots" id="sliderDots"></div>

                    <!-- Progress Bar -->
                    <div class="slider-progress-bar">
                        <div class="progress-fill"></div>
                    </div>
                </div>
            </section>

            <section class="section">
                <div class="section-header">
                    <h2 class="section-title">New Arrivals</h2>
                    <a href="#" class="see-all" onclick="App.switchNav('categories')">See All</a>
                </div>
                <div class="product-grid" id="productGrid"></div>
            </section>
        </main>
    </div>
    <!-- Navigation Moved Here -->
    <nav class="bottom-nav" id="mainNav" style="display: none;">
        <button class="nav-item active" data-nav="home" onclick="App.switchNav('home')">
            <svg viewBox="0 0 24 24">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                <polyline points="9 22 9 12 15 12 15 22" />
            </svg>
            <span>Home</span>
        </button>
        <button class="nav-item" data-nav="categories" onclick="App.switchNav('categories')">
            <svg viewBox="0 0 24 24">
                <rect x="3" y="3" width="7" height="7" />
                <rect x="14" y="3" width="7" height="7" />
                <rect x="14" y="14" width="7" height="7" />
                <rect x="3" y="14" width="7" height="7" />
            </svg>
            <span>Categories</span>
        </button>
        <button class="nav-item" data-nav="search" onclick="App.toggleSearch()">
            <svg viewBox="0 0 24 24">
                <circle cx="11" cy="11" r="8" />
                <path d="m21 21-4.35-4.35" />
            </svg>
            <span>Search</span>
        </button>
        <button class="nav-item" data-nav="cart" onclick="App.toggleCart()">
            <svg viewBox="0 0 24 24">
                <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z" />
                <line x1="3" y1="6" x2="21" y2="6" />
                <path d="M16 10a4 4 0 0 1-8 0" />
            </svg>
            <span>Cart</span>
        </button>
        <button class="nav-item" data-nav="profile" onclick="App.showProfile()">
            <svg viewBox="0 0 24 24">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                <circle cx="12" cy="7" r="4" />
            </svg>
            <span>Profile</span>
        </button>
    </nav>

    <div class="checkout-screen screen" id="checkoutScreen" style="display:flex; flex-direction:column;">
        <div class="checkout-header">
            <button class="back-btn" onclick="NavigationManager.pop()">
                <svg viewBox="0 0 24 24">
                    <polyline points="15 18 9 12 15 6" />
                </svg>
            </button>
            <h1 class="checkout-title heading">Checkout</h1>
        </div>
        <div class="checkout-steps">
            <div class="step active" id="step1"><span class="step-num">1</span></div>
            <div class="step-line"></div>
            <div class="step" id="step2"><span class="step-num">2</span></div>
            <div class="step-line"></div>
            <div class="step" id="step3"><span class="step-num">3</span></div>
        </div>
        <div class="checkout-content" style="flex:1; overflow-y:auto; padding-bottom: 20px;">
            <div class="checkout-section">
                <h3 class="checkout-section-title">Delivery Address</h3>
                <div class="form-group" style="margin-bottom:12px">
                    <input type="text" class="form-input" placeholder=" " value="John Doe">
                    <label class="form-label">Full Name</label>
                </div>
                <div class="form-group" style="margin-bottom:12px">
                    <input type="text" class="form-input" placeholder=" " value="123 Main Street, Apt 4B">
                    <label class="form-label">Address</label>
                </div>
                <div class="form-group" style="margin-bottom:12px">
                    <input type="text" class="form-input" placeholder=" " value="Mumbai, Maharashtra 400001">
                    <label class="form-label">City, State, PIN</label>
                </div>
                <div class="form-group">
                    <input type="tel" class="form-input" placeholder=" " value="+91 98765 43210">
                    <label class="form-label">Phone</label>
                </div>
            </div>
            <div class="checkout-section">
                <h3 class="checkout-section-title">Payment Method</h3>
                <div class="payment-methods">
                    <div class="payment-method active">
                        <div class="payment-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="5" y="2" width="14" height="20" rx="2" ry="2"></rect>
                                <line x1="12" y1="18" x2="12.01" y2="18"></line>
                            </svg>
                        </div>
                        <div class="payment-info">
                            <div class="payment-name">Pay via Apps</div>
                            <div class="payment-desc">GPay, PhonePe, Paytm</div>
                        </div>
                    </div>
                </div>
                <div class="upi-instructions active"
                    style="margin-top:16px; background:var(--bg-secondary); padding:16px; border-radius:var(--radius-md); border: 1px solid var(--purple-100);">
                    <p style="margin-bottom:8px; font-size:14px; color:var(--text-secondary)">Please transfer the total
                        amount to:</p>
                    <p
                        style="font-size:20px; font-weight:700; color:var(--purple-600); letter-spacing:1px; margin-bottom:4px">
                        9789252705</p>
                    <p style="font-size:12px; color:var(--text-muted)">Verified name: Izhai Sarees</p>

                    <div style="display:flex; gap:12px; margin-top:16px">
                        <div
                            style="flex:1; height:40px; background:#fff; border-radius:6px; border:1px solid #e0e0e0; display:flex; align-items:center; justify-content:center; font-weight:600; font-size:12px">
                            GPay</div>
                        <div
                            style="flex:1; height:40px; background:#fff; border-radius:6px; border:1px solid #e0e0e0; display:flex; align-items:center; justify-content:center; font-weight:600; font-size:12px">
                            PhonePe</div>
                        <div
                            style="flex:1; height:40px; background:#fff; border-radius:6px; border:1px solid #e0e0e0; display:flex; align-items:center; justify-content:center; font-weight:600; font-size:12px">
                            Paytm</div>
                    </div>
                </div>
            </div>
            <div class="checkout-section">
                <h3 class="checkout-section-title">Order Summary</h3>
                <div id="checkoutSummary"></div>
                <div
                    style="display:flex;justify-content:space-between;font-weight:700;font-size:18px;margin-top:16px;padding-top:16px;border-top:1px solid #f0f0f0">
                    <span>Total</span>
                    <span id="checkoutTotal" style="color:var(--purple-600)">0</span>
                </div>
            </div>
        </div>
        <div class="checkout-footer">
            <button class="btn btn-primary ripple" style="width:100%;margin:0" onclick="App.processPayment()">Pay
                Now</button>
        </div>
    </div>
    <div class="payment-modal" id="paymentModal">
        <div class="payment-modal-content">
            <div class="payment-status-icon processing" id="paymentStatusIcon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    style="animation:spin 1s linear infinite">
                    <path d="M21 12a9 9 0 1 1-6.219-8.56"></path>
                </svg>
            </div>
            <h3 class="payment-status-title heading" id="paymentStatusTitle">Processing Payment</h3>
            <p class="payment-status-desc" id="paymentStatusDesc">Redirecting to your UPI app...</p>
            <button class="btn btn-primary ripple hidden" id="paymentDoneBtn" onclick="App.confirmOrder()">Send Order
                Details</button>
        </div>
    </div>

    <!-- Contact Modal -->
    <div class="contact-modal" id="contactModal">
        <div class="contact-content">
            <button class="contact-close" onclick="App.toggleContact()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            <h3 class="heading" style="color:var(--purple-800); margin-bottom: 24px;">Contact Us</h3>

            <div class="contact-option">
                <div class="contact-icon-box">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path
                            d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z">
                        </path>
                    </svg>
                </div>
                <div class="contact-text">
                    <span class="contact-label">Phone & WhatsApp</span>
                    <div class="contact-value" onclick="window.location.href='tel:+919789252705'">+91 97892 52705</div>
                </div>
            </div>

            <div class="contact-option">
                <div class="contact-icon-box">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                        <polyline points="22,6 12,13 2,6"></polyline>
                    </svg>
                </div>
                <div class="contact-text">
                    <span class="contact-label">Email Support</span>
                    <div class="contact-value">support@izhaisarees.com</div>
                </div>
            </div>

            <div class="contact-option">
                <div class="contact-icon-box">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                        <circle cx="12" cy="10" r="3"></circle>
                    </svg>
                </div>
                <div class="contact-text">
                    <span class="contact-label">Visit Store</span>
                    <div class="contact-value">Chennai, Tamil Nadu</div>
                </div>
            </div>
        </div>
    </div>
    <div class="search-overlay" id="searchOverlay">
        <div class="search-header">
            <div class="search-input-wrapper">
                <svg class="search-icon-inner" viewBox="0 0 24 24" fill="none">
                    <circle cx="11" cy="11" r="8" stroke="currentColor" />
                    <path d="m21 21-4.35-4.35" stroke="currentColor" stroke-linecap="round" />
                </svg>
                <input type="text" class="search-input" id="searchInput" placeholder="Search sarees, kurtis, silk..."
                    oninput="App.handleSearch(this.value)">
            </div>
            <button class="search-close-btn" onclick="App.toggleSearch()">Cancel</button>
        </div>

        <!-- Category Filter Badge -->
        <div class="search-category-badge" id="searchCategoryBadge">
            <svg viewBox="0 0 24 24" fill="none">
                <path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-linecap="round" />
            </svg>
            <span id="categoryBadgeText">Searching in: All</span>
            <button class="clear-filter-btn" onclick="App.clearCategoryFilter()" title="Clear filter">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>

        <div class="search-results" id="searchResults">
            <div class="search-empty">
                <span class="search-empty-icon"></span>
                <p>Start typing to search for your favorites</p>
            </div>
        </div>
    </div>
    <div class="profile-screen screen" id="profileScreen">
        <div class="profile-wrapper">
            <!-- Sidebar / Header Card -->
            <div class="profile-sidebar-card">
                <div class="detail-header"
                    style="position:absolute;top:0;left:0;right:0;z-index:10;background:transparent">
                    <button class="back-btn" style="background:rgba(255,255,255,0.2)" onclick="NavigationManager.pop()">
                        <svg viewBox="0 0 24 24" style="stroke:white">
                            <polyline points="15 18 9 12 15 6" />
                        </svg>
                    </button>
                    <div></div>
                </div>
                <div class="profile-header-bg">
                    <div class="profile-avatar" id="profileAvatar">GU</div>
                    <div class="profile-info-header">
                        <h2 class="profile-name heading" id="profileName">Guest User</h2>
                        <p class="profile-email" id="profileEmail">guest@izhai.com</p>
                    </div>
                </div>
                <div class="profile-stats-row">
                    <div class="stat-item">
                        <span class="stat-value" id="statOrders">0</span>
                        <span class="stat-label">Orders</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="statWishlist">0</span>
                        <span class="stat-label">Wishlist</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">0</span>
                        <span class="stat-label">Points</span>
                    </div>
                </div>
            </div>

            <!-- Main Content Area -->
            <div class="profile-main-content">
                <div class="profile-content-scroll">
                    <!-- Account Section -->
                    <div class="profile-section-group">
                        <h3 class="profile-section-title">My Account</h3>
                        <div class="profile-menu-container">
                            <button class="profile-menu-item" onclick="App.showEditProfile()">
                                <div class="menu-icon-bg">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                                        <circle cx="12" cy="7" r="4" />
                                    </svg>
                                </div>
                                <div class="menu-item-text">
                                    <span class="menu-item-title">Edit Profile</span>
                                    <span class="menu-item-desc">Change name, email, and password</span>
                                </div>
                            </button>
                            <button class="profile-menu-item" onclick="App.showOrders()">
                                <div class="menu-icon-bg">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z" />
                                        <line x1="3" y1="6" x2="21" y2="6" />
                                        <path d="M16 10a4 4 0 0 1-8 0" />
                                    </svg>
                                </div>
                                <div class="menu-item-text">
                                    <span class="menu-item-title">My Orders</span>
                                    <span class="menu-item-desc">Track and manage your purchases</span>
                                </div>
                            </button>
                            <button class="profile-menu-item" onclick="App.showWishlistScreen()">
                                <div class="menu-icon-bg">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <path
                                            d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" />
                                    </svg>
                                </div>
                                <div class="menu-item-text">
                                    <span class="menu-item-title">Wishlist</span>
                                    <span class="menu-item-desc">Your favorite sarees and kurtis</span>
                                </div>
                            </button>
                        </div>
                    </div>

                    <!-- Dashboard Slot (Innovative View) -->
                    <div id="profileDashboardSlot" class="profile-dashboard-slot">
                        <!-- Content injected here via JS -->
                    </div>

                    <!-- Admin Section (Dynamic) -->
                    <div class="profile-section-group admin-only" style="display: none;">
                        <h3 class="profile-section-title">Store Management</h3>
                        <div class="profile-menu-container">
                            <button class="profile-menu-item" onclick="App.showAddProduct()">
                                <div class="menu-icon-bg">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <line x1="12" y1="5" x2="12" y2="19"></line>
                                        <line x1="5" y1="12" x2="19" y2="12"></line>
                                    </svg>
                                </div>
                                <div class="menu-item-text">
                                    <span class="menu-item-title">Add Product</span>
                                    <span class="menu-item-desc">Add new inventory items</span>
                                </div>
                            </button>
                        </div>
                    </div>

                    <!-- App Section -->
                    <div class="profile-section-group">
                        <div class="profile-menu-container">
                            <button class="profile-menu-item danger" onclick="App.logout()">
                                <div class="menu-icon-bg">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                                        <polyline points="16 17 21 12 16 7" />
                                        <line x1="21" y1="12" x2="9" y2="12" />
                                    </svg>
                                </div>
                                <div class="menu-item-text">
                                    <span class="menu-item-title">Log Out</span>
                                    <span class="menu-item-desc">Safely sign out of your account</span>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="screen" id="addProductScreen" style="z-index: 3500; background: var(--bg-primary);">
        <div class="detail-header" style="background: var(--bg-glass); backdrop-filter: blur(20px);">
            <button class="back-btn" onclick="NavigationManager.pop()">
                <svg viewBox="0 0 24 24">
                    <polyline points="15 18 9 12 15 6" />
                </svg>
            </button>
            <h2 class="heading" style="font-size: 20px; color: var(--purple-800);">Add New Product</h2>
            <div style="width: 44px;"></div>
        </div>
        <div class="auth-container" style="padding-top: 20px;">
            <form id="addProductForm" onsubmit="App.handleAddProduct(event)">
                <div class="form-group">
                    <div
                        style="width: 100%; height: 200px; background: #e8e8f0; border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center; overflow: hidden; margin-bottom: 16px; position: relative; border: 2px dashed #ccc;">
                        <img id="imagePreview" src=""
                            style="width: 100%; height: 100%; object-fit: cover; display: none;">
                        <input type="file" accept="image/*" onchange="App.handleImageUpload(this)"
                            style="position: absolute; inset: 0; opacity: 0; cursor: pointer;">
                        <div style="text-align: center; pointer-events: none;" id="uploadPlaceholder">
                            <div style="font-size: 24px; margin-bottom:8px">
                                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="var(--purple-400)"
                                    stroke-width="2">
                                    <path
                                        d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z">
                                    </path>
                                    <circle cx="12" cy="13" r="4"></circle>
                                </svg>
                            </div>
                            <p style="font-size: 12px; color: var(--text-secondary);">Tap to upload image</p>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <input type="text" name="prodName" class="form-input" placeholder=" " required>
                    <label class="form-label">Product Name</label>
                </div>

                <div class="form-group" style="display: flex; gap: 12px;">
                    <div style="flex: 1; position: relative;">
                        <input type="number" name="prodPrice" class="form-input" placeholder=" " required>
                        <label class="form-label">Price</label>
                    </div>
                    <div style="flex: 1; position: relative;">
                        <input type="number" name="prodOrigPrice" class="form-input" placeholder=" " required>
                        <label class="form-label">Original Price</label>
                    </div>
                </div>

                <div class="form-group" style="display: flex; gap: 12px;">
                    <div style="flex: 1;">
                        <select name="prodCat" class="form-input">
                            <option value="saree">Saree</option>
                            <option value="kurti">Kurti</option>
                        </select>
                    </div>
                    <div style="flex: 1;">
                        <input type="text" name="prodFabric" class="form-input" placeholder="Fabric (e.g. Silk)"
                            required>
                    </div>
                </div>

                <div class="form-group">
                    <textarea name="prodDesc" class="form-input" placeholder="Product Description" rows="4"
                        style="height: auto;"></textarea>
                </div>

                <button type="submit" class="form-btn ripple">Save Product</button>
            </form>
        </div>
    </div>


    <!-- Product Detail Page (Ported) -->
    <div class="product-detail" id="productDetail">
        <div class="detail-header">
            <button class="back-btn" onclick="NavigationManager.pop()">
                <svg viewBox="0 0 24 24">
                    <polyline points="15 18 9 12 15 6" />
                </svg>
            </button>
            <button class="icon-btn wishlist-btn" onclick="App.toggleWishlistDetail()">
                <svg viewBox="0 0 24 24">
                    <path
                        d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" />
                </svg>
            </button>
        </div>
        <div class="product-detail-wrapper">
            <!-- Wrapper for Desktop Flex Layout -->
            <div class="detail-gallery" id="detailGallery">
                <img id="detailImage" src="" alt="">
                <div class="gallery-dots">
                    <span class="gallery-dot active"></span>
                    <span class="gallery-dot"></span>
                    <span class="gallery-dot"></span>
                </div>
            </div>
            <div class="detail-content">
                <h1 class="detail-title heading" id="detailTitle">Product Name</h1>
                <div class="detail-price" id="detailPrice">0</div>
                <div class="size-selector">
                    <div class="size-label">Select Size</div>
                    <div class="size-options" id="sizeOptions">
                        <button class="size-chip" data-size="S" onclick="App.selectSize('S')">S</button>
                        <button class="size-chip active" data-size="M" onclick="App.selectSize('M')">M</button>
                        <button class="size-chip" data-size="L" onclick="App.selectSize('L')">L</button>
                        <button class="size-chip" data-size="XL" onclick="App.selectSize('XL')">XL</button>
                    </div>
                </div>
                <p class="detail-description" id="detailDesc">Premium quality fabric with intricate handwoven patterns.
                    Perfect for special occasions and festivals.</p>

                <!-- Size Chart Link -->
                <div class="size-chart-link">
                    <button class="size-chart-btn" onclick="App.openSizeChart()">
                        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" />
                            <line x1="3" y1="9" x2="21" y2="9" />
                            <line x1="9" y1="21" x2="9" y2="9" />
                        </svg>
                        View Size Chart
                    </button>
                </div>

                <div id="cartInitialAction" style="display: block;">
                    <button class="add-cart-btn ripple" id="addCartBtn" onclick="App.addToCartFromDetail()">Add to
                        Cart</button>
                </div>
                <div class="cart-action-group" id="cartInAction">
                    <button class="form-btn btn-remove-cart ripple"
                        onclick="App.removeFromCartFromDetail()">Remove</button>
                    <button class="form-btn btn-view-cart ripple" onclick="App.openCartFromDetail()">View Cart</button>
                </div>
            </div>
        </div>

        <!-- Ratings & Reviews Section -->
        <div class="product-features-section">
            <div class="ratings-overview">
                <div class="rating-summary">
                    <div class="rating-score">
                        <span class="rating-number" id="avgRating">4.5</span>
                        <div class="rating-stars" id="avgStars">
                            
                        </div>
                        <span class="rating-count" id="ratingCount">248 ratings</span>
                    </div>
                </div>
            </div>

            <!-- Reviews Section -->
            <div class="reviews-section">
                <div class="section-header">
                    <h3 class="heading">Customer Reviews</h3>
                    <button class="write-review-btn" onclick="App.openReviewModal()">
                        <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M12 20h9" />
                            <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z" />
                        </svg>
                        Write a Review
                    </button>
                </div>
                <div class="reviews-list" id="reviewsList">
                    <!-- Reviews will be rendered here by JS -->
                </div>
            </div>

            <!-- Recommendations Section -->
            <div class="recommendations-section">
                <h3 class="heading">You May Also Like</h3>
                <div class="recommendations-grid" id="recommendationsGrid">
                    <!-- Recommendations will be rendered here by JS -->
                </div>
            </div>
        </div>
    </div>

    <!-- Size Chart Modal -->
    <div class="modal-overlay" id="sizeChartModal">
        <div class="modal-content size-chart-modal">
            <div class="modal-header">
                <h3 class="heading">Size Chart</h3>
                <button class="modal-close-btn" onclick="App.closeSizeChart()">
                    <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="size-chart-tabs">
                    <button class="size-tab active" onclick="App.switchSizeTab('saree')">Saree</button>
                    <button class="size-tab" onclick="App.switchSizeTab('kurti')">Kurti</button>
                </div>
                <div class="size-chart-table" id="sizeChartTable">
                    <!-- Size chart table will be rendered here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Review Modal -->
    <div class="modal-overlay" id="reviewModal">
        <div class="modal-content review-modal">
            <div class="modal-header">
                <h3 class="heading">Write a Review</h3>
                <button class="modal-close-btn" onclick="App.closeReviewModal()">
                    <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <form onsubmit="App.submitReview(event)" id="reviewForm">
                    <div class="form-group">
                        <label>Your Rating</label>
                        <div class="star-rating-input" id="starRatingInput">
                            <span class="star" data-rating="1" onclick="App.setRating(1)"></span>
                            <span class="star" data-rating="2" onclick="App.setRating(2)"></span>
                            <span class="star" data-rating="3" onclick="App.setRating(3)"></span>
                            <span class="star" data-rating="4" onclick="App.setRating(4)"></span>
                            <span class="star" data-rating="5" onclick="App.setRating(5)"></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Review Title</label>
                        <input type="text" class="form-input" id="reviewTitle" placeholder="Summarize your experience"
                            required>
                    </div>
                    <div class="form-group">
                        <label>Your Review</label>
                        <textarea class="form-input" id="reviewText" rows="4"
                            placeholder="Share your thoughts about this product" required></textarea>
                    </div>
                    <button type="submit" class="form-btn btn-primary ripple">Submit Review</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Dashboard Modal -->
    <div class="dashboard-modal" id="dashboardModal">
        <div class="dashboard-modal-content">
            <div class="dashboard-modal-header">
                <h3 class="heading" id="dashboardModalTitle" style="margin: 0; color: var(--purple-800)">Notice</h3>
                <button class="close-dashboard-modal" onclick="App.closeDashboardModal()">
                    <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor"
                        stroke-width="2.5">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="dashboard-modal-body" id="dashboardModalBody">
                <!-- Dynamic Content -->
            </div>
        </div>
    </div>

    <!-- Cart Sidebar -->
    <div class="cart-overlay" id="cartOverlay" onclick="App.toggleCart()"></div>
    <div class="cart-sidebar" id="cartSidebar">
        <div class="cart-header">
            <div>
                <h3 class="cart-title">Your Bag</h3>
                <div class="cart-count-badge" id="cartCountHeader">0 items</div>
            </div>
            <button class="close-cart-btn" onclick="App.toggleCart()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div class="cart-items" id="cartItems"></div>
        <div class="cart-footer">
            <div class="cart-total-row">
                <div>
                    <div class="total-label">Total Amount</div>
                    <div class="total-label" style="font-size:11px; text-transform:none">Including taxes</div>
                </div>
                <div class="total-amount" id="cartTotal">0</div>
            </div>
            <button class="checkout-btn" onclick="App.checkout()">
                PROCEED TO CHECKOUT
            </button>
        </div>
    </div>

    <!-- Categories Screen -->
    <!-- Ethereal Glass Categories Screen -->
    <!-- Categories Screen -->
    <div id="categoriesScreen" class="screen">
        <!-- Refined Bento Grid - No Header/Filters -->
        <div class="bento-grid" style="padding-top: 20px;">
            <!-- Hero Item: Sarees -->
            <div class="glass-card bento-item bento-item-hero" onclick="App.openCategory('saree')">
                <img src="data:image/svg+xml,%3Csvg width='800' height='800' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3ClinearGradient id='grad1' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%234a148c;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%237c4dff;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='800' height='800' fill='url(%23grad1)'/%3E%3Cpath d='M0 400 Q 400 0 800 400' stroke='rgba(255,255,255,0.1)' fill='none' stroke-width='100'/%3E%3C/svg%3E"
                    class="bento-bg-img" alt="Sarees">
                <div class="bento-overlay"></div>
                <div class="bento-content">
                    <h2 class="bento-title">Sarees</h2>
                    <p class="bento-subtitle">45+ Handwoven Masterpieces</p>
                </div>
            </div>

            <!-- Standard Item: Kurtis -->
            <div class="glass-card bento-item bento-item-standard" onclick="App.openCategory('kurti')">
                <img src="data:image/svg+xml,%3Csvg width='400' height='400' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3ClinearGradient id='grad2' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%2300695c;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%2326a69a;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='400' height='400' fill='url(%23grad2)'/%3E%3C/svg%3E"
                    class="bento-bg-img" alt="Kurtis">
                <div class="bento-overlay"></div>
                <div class="bento-content">
                    <h2 class="bento-title">Kurtis</h2>
                    <p class="bento-subtitle">Contemporary Chic</p>
                </div>
            </div>

            <!-- Standard Item: Bridal -->
            <div class="glass-card bento-item bento-item-standard" onclick="App.openCategory('wedding')">
                <img src="data:image/svg+xml,%3Csvg width='400' height='400' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3ClinearGradient id='grad3' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23ad1457;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23ec407a;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='400' height='400' fill='url(%23grad3)'/%3E%3C/svg%3E"
                    class="bento-bg-img" alt="Bridal">
                <div class="bento-overlay"></div>
                <div class="bento-content">
                    <h2 class="bento-title">Bridal</h2>
                    <p class="bento-subtitle">For Your Special Day</p>
                </div>
            </div>

            <!-- Wide Item: Silk -->
            <div class="glass-card bento-item bento-item-standard wide" onclick="App.openCategory('silk')">
                <img src="data:image/svg+xml,%3Csvg width='800' height='400' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3ClinearGradient id='grad4' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23f9a825;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23fbc02d;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='800' height='400' fill='url(%23grad4)'/%3E%3C/svg%3E"
                    class="bento-bg-img" alt="Silk">
                <div class="bento-overlay"></div>
                <div class="bento-content">
                    <h2 class="bento-title">Pure Silk</h2>
                    <p class="bento-subtitle">The Fabric of Royalty</p>
                </div>
            </div>

            <!-- Standard Item: Cotton -->
            <div class="glass-card bento-item bento-item-standard" onclick="App.openCategory('cotton')">
                <img src="data:image/svg+xml,%3Csvg width='400' height='400' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3ClinearGradient id='grad5' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%232e7d32;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%2366bb6a;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='400' height='400' fill='url(%23grad5)'/%3E%3C/svg%3E"
                    class="bento-bg-img" alt="Cotton">
                <div class="bento-overlay"></div>
                <div class="bento-content">
                    <h2 class="bento-title">Cotton</h2>
                    <p class="bento-subtitle">Everyday Comfort</p>
                </div>
            </div>

            <!-- Standard Item: Party -->
            <div class="glass-card bento-item bento-item-standard" onclick="App.openCategory('party')">
                <img src="data:image/svg+xml,%3Csvg width='400' height='400' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3ClinearGradient id='grad6' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%231565c0;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%2342a5f5;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='400' height='400' fill='url(%23grad6)'/%3E%3C/svg%3E"
                    class="bento-bg-img" alt="Party">
                <div class="bento-overlay"></div>
                <div class="bento-content">
                    <h2 class="bento-title">Party</h2>
                    <p class="bento-subtitle">Shine & Sparkle</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Category Detail Screen (Nested) -->
    <div id="categoryDetailScreen" class="screen">
        <header class="app-header category-header"
            style="background: rgba(255,255,255,0.95); backdrop-filter: blur(15px); border-bottom: 1px solid rgba(0,0,0,0.05);">
            <button class="icon-btn" onclick="NavigationManager.pop()" style="margin-right: 15px;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left">
                    <line x1="19" y1="12" x2="5" y2="12"></line>
                    <polyline points="12 19 5 12 12 5"></polyline>
                </svg>
            </button>
            <div class="heading" id="categoryDetailTitle"
                style="font-size: 20px; color: var(--purple-900); font-weight: 600;">Category</div>
            <div style="flex:1"></div>
            <button class="icon-btn" onclick="App.toggleSearch()">
                <svg viewBox="0 0 24 24" stroke="var(--purple-800)">
                    <circle cx="11" cy="11" r="8" />
                    <path d="m21 21-4.35-4.35" />
                </svg>
            </button>
        </header>

        <div class="product-grid" id="categoryDetailGrid">
            <!-- Products injected here -->
        </div>
    </div>
    <script>
        const NavigationManager = {
            stack: ['intro'],
            screenStates: {},

            push(screenId, state = {}) {
                // Close overlays before navigation
                this.closeAllOverlays();

                // Hide current screen
                const current = this.getCurrentScreen();
                if (current) {
                    document.getElementById(current)?.classList.remove('active');
                }

                // Add to stack
                this.stack.push(screenId);
                this.screenStates[screenId] = state;

                // Show new screen
                const newEl = document.getElementById(screenId);
                if (newEl) {
                    newEl.classList.add('active');
                }

                // Update bottom nav
                this.updateBottomNav();

                // Update browser history
                window.history.pushState({ screenId }, '', `#${screenId}`);
            },

            pop() {
                if (this.stack.length <= 1) return false;

                // Close overlays
                this.closeAllOverlays();

                // Remove current screen
                const current = this.stack.pop();
                document.getElementById(current)?.classList.remove('active');
                delete this.screenStates[current];

                // Clear category filter if leaving category detail screen
                if (current === 'categoryDetailScreen') {
                    App.currentCategoryFilter = null;
                }

                // Show previous screen
                const previous = this.getCurrentScreen();
                const prevEl = document.getElementById(previous);
                if (prevEl) {
                    prevEl.classList.add('active');
                }

                // Update bottom nav
                this.updateBottomNav();

                // Check if returning to search
                if (previous === 'app' && App.returnToSearch) {
                    setTimeout(() => {
                        const searchOverlay = document.getElementById('searchOverlay');
                        const searchInput = document.getElementById('searchInput');

                        if (searchOverlay && searchInput) {
                            searchOverlay.classList.add('active');
                            searchInput.value = App.lastSearchQuery || '';
                            App.handleSearch(App.lastSearchQuery || '');
                            searchInput.focus();
                        }

                        App.returnToSearch = false;
                        App.lastSearchQuery = '';
                    }, 100);
                }

                return true;
            },

            replace(screenId, state = {}) {
                // Close overlays
                this.closeAllOverlays();

                // Replace current screen
                const current = this.stack.pop();
                const currEl = document.getElementById(current);
                if (currEl) {
                    currEl.classList.remove('active');
                }
                delete this.screenStates[current];

                this.stack.push(screenId);
                this.screenStates[screenId] = state;
                const newEl = document.getElementById(screenId);
                if (newEl) {
                    newEl.classList.add('active');
                }

                this.updateBottomNav();
            },

            reset(screenId = 'app') {
                // Close everything
                this.closeAllOverlays();

                // Clear stack
                this.stack.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.classList.remove('active');
                });
                this.stack = [screenId];
                this.screenStates = {};

                // Show new root
                const rootEl = document.getElementById(screenId);
                if (rootEl) {
                    rootEl.classList.add('active');
                }
                this.updateBottomNav();
            },

            getCurrentScreen() {
                return this.stack[this.stack.length - 1];
            },

            isOnScreen(screenId) {
                return this.getCurrentScreen() === screenId;
            },

            closeAllOverlays() {
                // Close cart
                const sidebar = document.getElementById('cartSidebar');
                const overlay = document.getElementById('cartOverlay');
                if (sidebar) sidebar.classList.remove('active');
                if (overlay) overlay.classList.remove('active');

                // Close search
                const search = document.getElementById('searchOverlay');
                if (search) search.classList.remove('active');

                // Close modals
                const payModal = document.getElementById('paymentModal');
                const dashModal = document.getElementById('dashboardModal');
                if (payModal) payModal.classList.remove('active');
                if (dashModal) dashModal.classList.remove('active');
            },

            updateBottomNav() {
                const current = this.getCurrentScreen();
                const nav = document.querySelector('.bottom-nav');

                // Show/hide nav based on screen
                const noNavScreens = ['intro', 'gateway', 'auth', 'checkoutScreen', 'addProductScreen'];
                if (noNavScreens.includes(current)) {
                    nav?.classList.add('force-hidden');
                } else {
                    nav?.classList.remove('force-hidden');
                }

                // Update active nav item
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });

                // Map screens to nav items
                const navMap = {
                    'app': 'home',
                    'categoriesScreen': 'categories',
                    'profileScreen': 'profile'
                };

                const activeNav = navMap[current];
                if (activeNav) {
                    const navItem = document.querySelector(`.nav-item[data-nav="${activeNav}"]`);
                    if (navItem) navItem.classList.add('active');
                }
            }
        };

        const GestureManager = {
            startX: 0,
            startY: 0,
            threshold: 100,

            init() {
                document.addEventListener('touchstart', (e) => {
                    this.startX = e.touches[0].clientX;
                    this.startY = e.touches[0].clientY;
                }, { passive: true });

                document.addEventListener('touchend', (e) => {
                    const endX = e.changedTouches[0].clientX;
                    const endY = e.changedTouches[0].clientY;

                    const diffX = endX - this.startX;
                    const diffY = Math.abs(endY - this.startY);

                    // Swipe back gesture
                    if (diffX > this.threshold && diffY < 100) {
                        const current = NavigationManager.getCurrentScreen();
                        const canSwipeBack = ['productDetail', 'categoriesScreen', 'profileScreen', 'addProductScreen', 'checkoutScreen'];
                        if (canSwipeBack.includes(current)) {
                            NavigationManager.pop();
                        }
                    }
                }, { passive: true });
            }
        };

        const App = {
            currentScreen: 'intro',
            currentCategoryFilter: null,
            user: null,
            cart: [],
            wishlist: [],
            orders: [],
            selectedProduct: null,
            selectedSize: 'M',
            returnToSearch: false,
            lastSearchQuery: '',
            selectedRating: 0,
            currentSizeChartTab: 'saree',
            reviews: {
                1: [
                    { author: 'Priya K', rating: 5, title: 'Perfect for weddings!', text: 'The silk quality is exceptional. Got so many compliments at the wedding!', date: '2 days ago' },
                    { author: 'Meera S', rating: 4, title: 'Beautiful color', text: 'The purple shade is gorgeous. Very elegant and traditional.', date: '1 week ago' }
                ],
                2: [
                    { author: 'Radha M', rating: 5, title: 'Worth every penny', text: 'Authentic Banarasi work. Stunning craftsmanship!', date: '3 days ago' }
                ],
                3: [
                    { author: 'Anjali R', rating: 5, title: 'Comfortable and stylish', text: 'Perfect for festivals. The cotton is breathable and the fit is great!', date: '5 days ago' }
                ]
            },
            sizeCharts: {
                saree: {
                    headers: ['Size', 'Blouse Bust', 'Blouse Waist', 'Blouse Length', 'Saree Length'],
                    rows: [
                        ['S', '32-34"', '26-28"', '14-15"', '5.5m'],
                        ['M', '36-38"', '30-32"', '15-16"', '5.5m'],
                        ['L', '40-42"', '34-36"', '16-17"', '6.3m'],
                        ['XL', '44-46"', '38-40"', '17-18"', '6.3m']
                    ]
                },
                kurti: {
                    headers: ['Size', 'Bust', 'Waist', 'Hip', 'Length'],
                    rows: [
                        ['S', '32-34"', '26-28"', '36-38"', '42"'],
                        ['M', '36-38"', '30-32"', '40-42"', '44"'],
                        ['L', '40-42"', '34-36"', '44-46"', '46"'],
                        ['XL', '44-46"', '38-40"', '48-50"', '48"']
                    ]
                }
            },
            products: [
                // SAREES - SILK & TRADITIONAL
                { id: 1, name: 'Royal Purple Silk Saree', price: 8999, originalPrice: 12999, category: 'saree', fabric: 'silk', occasion: 'wedding', image: 'data:image/svg+xml,%3Csvg width="300" height="400" xmlns="http://www.w3.org/2000/svg"%3E%3Cdefs%3E%3ClinearGradient id="g1" x1="0%25" y1="0%25" x2="100%25" y2="100%25"%3E%3Cstop offset="0%25" style="stop-color:%237c4dff"%3E%3C/stop%3E%3Cstop offset="100%25" style="stop-color:%234a2c6f"%3E%3C/stop%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width="300" height="400" fill="url(%23g1)"%3E%3C/rect%3E%3Cpath d="M0 200 Q75 180 150 200 T300 200" stroke="rgba(255,255,255,0.2)" fill="none" stroke-width="40"%3E%3C/path%3E%3C/svg%3E', description: 'Royal Purple Silk Saree with intricate gold zari work. Perfect for weddings and grand occasions.' },
                { id: 2, name: 'Golden Banarasi Silk', price: 15999, originalPrice: 19999, category: 'saree', fabric: 'silk', occasion: 'wedding', image: 'data:image/svg+xml,%3Csvg width="300" height="400" xmlns="http://www.w3.org/2000/svg"%3E%3Cdefs%3E%3ClinearGradient id="g2" x1="0%25" y1="0%25" x2="100%25" y2="100%25"%3E%3Cstop offset="0%25" style="stop-color:%23d4af37"%3E%3C/stop%3E%3Cstop offset="100%25" style="stop-color:%23b8860b"%3E%3C/stop%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width="300" height="400" fill="url(%23g2)"%3E%3C/rect%3E%3Cpath d="M50 0 L50 400 M100 0 L100 400 M150 0 L150 400 M200 0 L200 400 M250 0 L250 400" stroke="rgba(255,255,255,0.15)" stroke-width="2"%3E%3C/path%3E%3C/svg%3E', description: 'Traditional Golden Banarasi Silk Saree featuring classic motifs and a rich border.' },
                { id: 4, name: 'Pink Designer Saree', price: 12999, originalPrice: 16999, category: 'saree', fabric: 'silk', occasion: 'party', image: 'data:image/svg+xml,%3Csvg width="300" height="400" xmlns="http://www.w3.org/2000/svg"%3E%3Cdefs%3E%3ClinearGradient id="g4" x1="0%25" y1="0%25" x2="100%25" y2="100%25"%3E%3Cstop offset="0%25" style="stop-color:%23ec407a"%3E%3C/stop%3E%3Cstop offset="100%25" style="stop-color:%23880e4f"%3E%3C/stop%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width="300" height="400" fill="url(%23g4)"%3E%3C/rect%3E%3C/svg%3E', description: 'Contemporary Pink Designer Saree with modern patterns and a sleek finish.' },
                { id: 8, name: 'Maroon Kanjivaram', price: 24999, originalPrice: 29999, category: 'saree', fabric: 'silk', occasion: 'wedding', image: 'data:image/svg+xml,%3Csvg width="300" height="400" xmlns="http://www.w3.org/2000/svg"%3E%3Cdefs%3E%3ClinearGradient id="g8" x1="0%25" y1="0%25" x2="100%25" y2="100%25"%3E%3Cstop offset="0%25" style="stop-color:%23b71c1c"%3E%3C/stop%3E%3Cstop offset="100%25" style="stop-color:%23880e4f"%3E%3C/stop%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width="300" height="400" fill="url(%23g8)"%3E%3C/rect%3E%3Cpath d="M0 100 L300 100 M0 200 L300 200 M0 300 L300 300" stroke="%23d4af37" stroke-width="3"%3E%3C/path%3E%3C/svg%3E', description: 'Exquisite Maroon Kanjivaram Saree, a masterpiece of traditional weaving.' },

                // SAREES - LIGHTWEIGHT
                { id: 13, name: 'Sky Blue Georgette', price: 5499, originalPrice: 7999, category: 'saree', fabric: 'georgette', occasion: 'party', image: 'data:image/svg+xml,%3Csvg width="300" height="400" xmlns="http://www.w3.org/2000/svg"%3E%3Crect width="300" height="400" fill="%2387CEEB"/%3E%3Ccircle cx="50" cy="50" r="20" fill="rgba(255,255,255,0.3)"/%3E%3Ccircle cx="250" cy="350" r="30" fill="rgba(255,255,255,0.3)"/%3E%3C/svg%3E', description: 'Lightweight flowy Georgette saree in sky blue. Easy to drape and perfect for parties.' },
                { id: 14, name: 'Floral Chiffon Saree', price: 3999, originalPrice: 5999, category: 'saree', fabric: 'chiffon', occasion: 'casual', image: 'data:image/svg+xml,%3Csvg width="300" height="400" xmlns="http://www.w3.org/2000/svg"%3E%3Crect width="300" height="400" fill="%23FFB7C5"/%3E%3Cpath d="M0 0 L300 400 M300 0 L0 400" stroke="white" stroke-width="2" opacity="0.5"/%3E%3C/svg%3E', description: 'Delicate Chiffon saree with floral prints. Ideal for summer outings.' },

                // KURTIS & ANARKALIS
                { id: 3, name: 'Teal Anarkali Kurti', price: 3499, originalPrice: 4999, category: 'kurti', fabric: 'cotton', occasion: 'festive', image: 'data:image/svg+xml,%3Csvg width="300" height="400" xmlns="http://www.w3.org/2000/svg"%3E%3Cdefs%3E%3ClinearGradient id="g3" x1="0%25" y1="0%25" x2="100%25" y2="100%25"%3E%3Cstop offset="0%25" style="stop-color:%2326a69a"%3E%3C/stop%3E%3Cstop offset="100%25" style="stop-color:%23004d40"%3E%3C/stop%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width="300" height="400" fill="url(%23g3)"%3E%3C/rect%3E%3Ccircle cx="150" cy="100" r="40" fill="rgba(255,255,255,0.1)"%3E%3C/circle%3E%3C/svg%3E', description: 'Elegant Teal Anarkali Kurti made from breathable cotton, ideal for festive wear.' },
                { id: 5, name: 'Emerald Cotton Kurti', price: 2499, originalPrice: 3499, category: 'kurti', fabric: 'cotton', occasion: 'casual', image: 'data:image/svg+xml,%3Csvg width="300" height="400" xmlns="http://www.w3.org/2000/svg"%3E%3Cdefs%3E%3ClinearGradient id="g5" x1="0%25" y1="0%25" x2="100%25" y2="100%25"%3E%3Cstop offset="0%25" style="stop-color:%232e7d32"%3E%3C/stop%3E%3Cstop offset="100%25" style="stop-color:%231b5e20"%3E%3C/stop%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width="300" height="400" fill="url(%23g5)"%3E%3C/rect%3E%3C/svg%3E', description: 'Comfortable Emerald Cotton Kurti, perfect for daily wear and casual outings.' },
                { id: 7, name: 'Navy Silk Kurti', price: 4999, originalPrice: 6999, category: 'kurti', fabric: 'silk', occasion: 'party', image: 'data:image/svg+xml,%3Csvg width="300" height="400" xmlns="http://www.w3.org/2000/svg"%3E%3Cdefs%3E%3ClinearGradient id="g7" x1="0%25" y1="0%25" x2="100%25" y2="100%25"%3E%3Cstop offset="0%25" style="stop-color:%231a237e"%3E%3C/stop%3E%3Cstop offset="100%25" style="stop-color:%23000051"%3E%3C/stop%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width="300" height="400" fill="url(%23g7)"%3E%3C/rect%3E%3C/svg%3E', description: 'Luxurious Navy Silk Kurti with hand-embroidered neckline.' },
                { id: 15, name: 'White Linen Kurti', price: 2999, originalPrice: 4499, category: 'kurti', fabric: 'linen', occasion: 'casual', image: 'data:image/svg+xml,%3Csvg width="300" height="400" xmlns="http://www.w3.org/2000/svg"%3E%3Crect width="300" height="400" fill="%23F5F5F5"/%3E%3Cline x1="150" y1="50" x2="150" y2="400" stroke="%23ddd" stroke-width="2"/%3E%3C/svg%3E', description: 'Pure white Linen Kurti for summer elegance.' },

                // COTTON & CHANDERI
                { id: 6, name: 'Ivory Chanderi Saree', price: 7999, originalPrice: 10999, category: 'saree', fabric: 'cotton', occasion: 'festive', image: 'data:image/svg+xml,%3Csvg width="300" height="400" xmlns="http://www.w3.org/2000/svg"%3E%3Cdefs%3E%3ClinearGradient id="g6" x1="0%25" y1="0%25" x2="100%25" y2="100%25"%3E%3Cstop offset="0%25" style="stop-color:%23f5f5dc"%3E%3C/stop%3E%3Cstop offset="100%25" style="stop-color:%23d4af37"%3E%3C/stop%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width="300" height="400" fill="url(%23g6)"%3E%3C/rect%3E%3C/svg%3E', description: 'Sophisticated Ivory Chanderi Saree with subtle gold detailing.' },
                { id: 16, name: 'Handblock Cotton Saree', price: 3200, originalPrice: 4500, category: 'saree', fabric: 'cotton', occasion: 'casual', image: 'data:image/svg+xml,%3Csvg width="300" height="400" xmlns="http://www.w3.org/2000/svg"%3E%3Crect width="300" height="400" fill="%23FFE4E1"/%3E%3Ccircle cx="50" cy="50" r="10" fill="%23CD5C5C"/%3E%3Ccircle cx="150" cy="150" r="10" fill="%23CD5C5C"/%3E%3Ccircle cx="250" cy="250" r="10" fill="%23CD5C5C"/%3E%3C/svg%3E', description: 'Traditional handblock printed cotton saree from Jaipur.' }
            ],

            init() {
                // Handle browser back/forward
                window.addEventListener('popstate', (e) => {
                    if (e.state?.screenId) {
                        NavigationManager.replace(e.state.screenId);
                    } else {
                        NavigationManager.pop();
                    }
                });

                // ESC Key Handler
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        const modal = document.getElementById('dashboardModal');
                        const searchOverlay = document.getElementById('searchOverlay');
                        const cartSidebar = document.getElementById('cartSidebar');

                        if (modal?.classList.contains('active')) {
                            this.closeDashboardModal();
                        } else if (searchOverlay?.classList.contains('active')) {
                            this.toggleSearch();
                        } else if (cartSidebar?.classList.contains('active')) {
                            this.toggleCart();
                        } else {
                            NavigationManager.pop();
                        }
                    }
                });

                // Initial navigation
                setTimeout(() => NavigationManager.push('gateway'), 3500);
                document.querySelectorAll('.auth-tab').forEach(tab => {
                    tab.addEventListener('click', () => this.switchAuthTab(tab.dataset.tab));
                });
                this.renderProducts();
                this.toggleAdminUI(false);
                this.updateCartUI();
                this.updateProfileUI();
                this.initSlider();
                GestureManager.init();
            },

            showAuth() {
                NavigationManager.push('auth');
            },

            enterApp() {
                this.user = this.user || {
                    name: 'Guest User',
                    email: 'guest@izhai.com',
                    isAdmin: false
                };

                const nav = document.getElementById('mainNav');
                if (nav) nav.style.display = 'flex';

                NavigationManager.reset('app');
                this.renderProducts();
                this.toggleAdminUI(this.user?.isAdmin);
                this.updateProfileUI();
            },

            switchAuthTab(tab) {
                document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
                document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
                document.getElementById('loginForm').classList.toggle('hidden', tab !== 'login');
                document.getElementById('signupForm').classList.toggle('hidden', tab !== 'signup');
            },

            async handleAuth(e) {
                e.preventDefault();
                const form = e.target;
                const isLogin = form.id === 'loginForm';

                if (isLogin) {
                    const emailOrUser = form.querySelector('input[type="email"], input[type="text"]').value;
                    const password = form.querySelector('input[type="password"]').value;

                    // Check credentials
                    const isValidUser = (emailOrUser.toLowerCase() === 'anitha8888@gmail.com' || emailOrUser === 'Anitha');
                    const isValidPass = (password === 'Tejadiya@711');

                    if (isValidUser && isValidPass) {
                        this.user = {
                            name: 'Anitha',
                            email: 'anitha8888@gmail.com',
                            isAdmin: true
                        };
                        alert('Welcome Admin Anitha!');
                        this.enterApp();
                    } else {
                        alert('Invalid Credentials! Please try again.');
                    }
                } else {
                    const name = form.querySelector('input[type="text"]').value;
                    const email = form.querySelector('input[type="email"]').value;
                    this.user = { name, email, isAdmin: false };
                    this.enterApp();
                }
            },


            toggleAdminUI(isAdmin) {
                const adminBtns = document.querySelectorAll('.admin-only');
                adminBtns.forEach(btn => {
                    btn.style.display = isAdmin ? 'flex' : 'none';
                });
            },

            updateProfileUI() {
                const name = this.user?.name || 'Guest User';
                const email = this.user?.email || 'guest@izhai.com';
                document.getElementById('profileName').textContent = name;
                document.getElementById('profileEmail').textContent = email;
                document.getElementById('profileAvatar').textContent = name.substring(0, 2).toUpperCase();

                // Update Stats
                const statOrders = document.getElementById('statOrders');
                if (statOrders) statOrders.textContent = this.orders.length;

                const statWishlist = document.getElementById('statWishlist');
                if (statWishlist) statWishlist.textContent = this.wishlist.length;
            },

            renderProducts(filter = 'all') {
                const grid = document.getElementById('productGrid');
                if (!grid) return;

                let filtered = this.products;

                if (filter !== 'all') {
                    filtered = this.products.filter(p =>
                        p.category === filter ||
                        p.fabric === filter ||
                        (p.occasion && p.occasion === filter)
                    );
                }

                // Update Section Title
                const sectionTitle = document.querySelector('.section-title');
                if (sectionTitle) {
                    if (filter === 'all') sectionTitle.textContent = 'Featured Collection';
                    else sectionTitle.textContent = filter.charAt(0).toUpperCase() + filter.slice(1) + ' Collection';
                }

                grid.innerHTML = filtered.map((p, idx) => `
            <div class="product-card" style="--idx: ${idx}; animation: fadeInUp 0.6s var(--ease-spring) backwards; animation-delay: ${idx * 0.1}s" onclick="App.showProduct(${p.id})">
                <div class="product-img">
                    <img src="${p.image}" alt="${p.name}" loading="lazy">
                    <button class="wishlist-btn ${this.wishlist.includes(p.id) ? 'active' : ''}" onclick="event.stopPropagation(); App.toggleWishlist(${p.id})">
                        <svg viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
                    </button>
                </div>
                <div class="product-info">
                    <div class="product-name">${p.name}</div>
                    <div class="product-price">${p.price.toLocaleString('en-IN')}<span class="product-original-price">${p.originalPrice.toLocaleString('en-IN')}</span></div>
                </div>
            </div>
        `).join('');
            },

            openCategory(cat) {
                const titleMap = {
                    'saree': 'Sarees',
                    'kurti': 'Kurtis',
                    'wedding': 'Bridal',
                    'silk': 'Pure Silk',
                    'cotton': 'Cotton',
                    'party': 'Party Wear',
                    'all': 'All Collections'
                };

                // Set the current category filter
                this.currentCategoryFilter = cat;

                // Update Title
                const titleEl = document.getElementById('categoryDetailTitle');
                if (titleEl) titleEl.textContent = titleMap[cat] || 'Collection';

                // Navigate
                NavigationManager.push('categoryDetailScreen');

                // Render Products in Detail Grid
                const grid = document.getElementById('categoryDetailGrid');
                if (grid) {
                    const filtered = this.products.filter(p =>
                        p.category === cat || p.fabric === cat || p.occasion === cat
                    );

                    if (filtered.length === 0) {
                        grid.innerHTML = '<div style="grid-column:1/-1; text-align:center; padding:40px; color:var(--text-secondary)">No products found in this category.</div>';
                        return;
                    }

                    grid.innerHTML = filtered.map((p, idx) => `
                        <div class="product-card" style="--idx: ${idx}; animation: fadeInUp 0.6s var(--ease-spring) backwards; animation-delay: ${idx * 0.05}s" onclick="App.showProduct(${p.id})">
                             <div class="product-img">
                                <img src="${p.image}" alt="${p.name}" loading="lazy">
                                <button class="wishlist-btn ${this.wishlist.includes(p.id) ? 'active' : ''}" onclick="event.stopPropagation(); App.toggleWishlist(${p.id})">
                                    <svg viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
                                </button>
                            </div>
                            <div class="product-info">
                                <div class="product-name">${p.name}</div>
                                <div class="product-price">${p.price.toLocaleString('en-IN')}<span class="product-original-price">${p.originalPrice.toLocaleString('en-IN')}</span></div>
                            </div>
                        </div>
                     `).join('');
                }
            },

            filterCategory(cat) {
                this.currentCategory = cat;

                // Update UI State for both new glass chips and old tabs
                document.querySelectorAll('.cat-tab, .glass-chip').forEach(t => {
                    t.classList.remove('active');
                    // Match based on data-cat or onclick content
                    if (t.dataset.cat === cat || t.getAttribute('onclick')?.includes(`'${cat}'`)) {
                        t.classList.add('active');
                    }
                });

                this.renderProducts(cat);
                this.pendingScrollToGrid = true;
            },

            filterCategoryView(cat) {
                // Handler for Categories Screen chips
                this.filterCategory(cat);
                this.switchNav('home');
            },

            switchNav(nav) {
                const screenMap = {
                    'home': 'app',
                    'categories': 'categoriesScreen',
                    'profile': 'profileScreen',
                    'search': null, // handled separately
                    'cart': null    // handled separately
                };

                if (nav === 'search') {
                    this.toggleSearch();
                    return;
                }

                if (nav === 'cart') {
                    this.toggleCart();
                    return;
                }

                const targetScreen = screenMap[nav];
                if (targetScreen) {
                    const current = NavigationManager.getCurrentScreen();

                    // If clicking same nav item, scroll to top unless we are filtering
                    if (current === targetScreen && !this.pendingScrollToGrid) {
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                        return;
                    }

                    // Replace screen (don't add to stack for bottom nav switches)
                    NavigationManager.replace(targetScreen);

                    // Handle auto-scroll to products if requested
                    if (nav === 'home' && this.pendingScrollToGrid) {
                        setTimeout(() => {
                            const grid = document.getElementById('productGrid');
                            if (grid) {
                                const headerOffset = 100; // Adjust for sticky header
                                const elementPosition = grid.getBoundingClientRect().top;
                                const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
                                window.scrollTo({
                                    top: offsetPosition,
                                    behavior: "smooth"
                                });
                            }
                            this.pendingScrollToGrid = false;
                        }, 100);
                    } else {
                        window.scrollTo(0, 0);
                    }
                }
            },

            writeReview() {
                alert('It is best considered to review it from the orders section after purchase.');
            },

            toggleContact() {
                const modal = document.getElementById('contactModal');
                if (modal) {
                    modal.classList.toggle('active');
                }
            },

            toggleWishlist(id) {
                const idx = this.wishlist.indexOf(id);
                if (idx > -1) this.wishlist.splice(idx, 1);
                else this.wishlist.push(id);

                this.renderProducts(document.querySelector('.cat-tab.active')?.dataset.cat || 'all');
                this.updateProfileUI();

                // If on category detail screen, re-render it to update hearts
                if (NavigationManager.isOnScreen('categoryDetailScreen') && this.currentCategoryFilter) {
                    this.openCategory(this.currentCategoryFilter);
                }
            },

            initSlider() {
                const slides = document.querySelectorAll('.slide');
                const dotsContainer = document.getElementById('sliderDots');
                if (!slides.length || !dotsContainer) return;

                // Create dots
                dotsContainer.innerHTML = '';
                slides.forEach((_, idx) => {
                    const dot = document.createElement('div');
                    dot.className = `slider-dot ${idx === 0 ? 'active' : ''}`;
                    dot.onclick = () => this.goToSlide(idx);
                    dotsContainer.appendChild(dot);
                });

                this.currentSlide = 0;
                this.slideInterval = setInterval(() => this.nextSlide(), 5000);
            },

            goToSlide(n) {
                const slides = document.querySelectorAll('.slide');
                const dots = document.querySelectorAll('.slider-dot');

                slides[this.currentSlide].classList.remove('active');
                dots[this.currentSlide].classList.remove('active');

                this.currentSlide = (n + slides.length) % slides.length;

                slides[this.currentSlide].classList.add('active');
                dots[this.currentSlide].classList.add('active');

                // Reset timer
                clearInterval(this.slideInterval);
                this.slideInterval = setInterval(() => this.nextSlide(), 5000);
            },

            nextSlide() {
                this.goToSlide(this.currentSlide + 1);
            },

            showProduct(id) {
                const product = this.products.find(p => p.id === id);
                if (!product) return;

                this.selectedProduct = product;
                this.currentProduct = product;

                // Update UI
                const img = document.getElementById('detailImage');
                if (img) img.src = product.image;
                const title = document.getElementById('detailTitle');
                if (title) title.textContent = product.name;
                const price = document.getElementById('detailPrice');
                if (price) price.textContent = '' + product.price.toLocaleString('en-IN');
                const desc = document.getElementById('detailDesc');
                if (desc) desc.textContent = product.description || "Premium quality fabric with intricate handwoven patterns.";

                this.updateDetailCartButtons(id);

                // Render reviews and recommendations
                this.renderReviews(id);
                this.renderRecommendations(product);

                NavigationManager.push('productDetail', { productId: id });
            },

            renderReviews(productId) {
                const reviewsList = document.getElementById('reviewsList');
                if (!reviewsList) return;

                const productReviews = this.reviews[productId] || [];

                if (productReviews.length === 0) {
                    reviewsList.innerHTML = `
                        <div style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                            <p>No reviews yet. Be the first to review this product!</p>
                        </div>
                    `;
                    return;
                }

                reviewsList.innerHTML = productReviews.map(review => `
                    <div class="review-item">
                        <div class="review-header">
                            <div class="review-author">
                                <div class="review-avatar">${review.author.substring(0, 2).toUpperCase()}</div>
                                <div class="review-author-info">
                                    <div class="review-author-name">${review.author}</div>
                                    <div class="review-date">${review.date}</div>
                                </div>
                            </div>
                            <div class="review-rating">${''.repeat(review.rating)}${''.repeat(5 - review.rating)}</div>
                        </div>
                        <div class="review-title">${review.title}</div>
                        <div class="review-text">${review.text}</div>
                    </div>
                `).join('');
            },

            renderRecommendations(currentProduct) {
                const grid = document.getElementById('recommendationsGrid');
                if (!grid) return;

                // Get products from the same category, excluding current product
                const recommendations = this.products
                    .filter(p => p.category === currentProduct.category && p.id !== currentProduct.id)
                    .slice(0, 4);

                if (recommendations.length === 0) {
                    grid.innerHTML = '<p style="text-align: center; grid-column: 1/-1; padding: 20px; color: var(--text-secondary);">No recommendations available</p>';
                    return;
                }

                grid.innerHTML = recommendations.map(p => `
                    <div class="recommendation-card" onclick="App.showProduct(${p.id})">
                        <div class="recommendation-img">
                            <img src="${p.image}" alt="${p.name}">
                        </div>
                        <div class="recommendation-info">
                            <div class="recommendation-name">${p.name}</div>
                            <div class="recommendation-price">${p.price.toLocaleString('en-IN')}</div>
                        </div>
                    </div>
                `).join('');
            },

            // Size Chart Modal
            openSizeChart() {
                const modal = document.getElementById('sizeChartModal');
                if (modal) {
                    modal.classList.add('active');
                    this.renderSizeChart(this.currentSizeChartTab);
                }
            },

            closeSizeChart() {
                const modal = document.getElementById('sizeChartModal');
                if (modal) modal.classList.remove('active');
            },

            switchSizeTab(tab) {
                this.currentSizeChartTab = tab;

                // Update tab buttons
                document.querySelectorAll('.size-tab').forEach(t => t.classList.remove('active'));
                event.target.classList.add('active');

                this.renderSizeChart(tab);
            },

            renderSizeChart(type) {
                const tableContainer = document.getElementById('sizeChartTable');
                if (!tableContainer) return;

                const chart = this.sizeCharts[type];
                if (!chart) return;

                let html = '<table>';
                html += '<thead><tr>';
                chart.headers.forEach(header => {
                    html += `<th>${header}</th>`;
                });
                html += '</tr></thead><tbody>';

                chart.rows.forEach(row => {
                    html += '<tr>';
                    row.forEach(cell => {
                        html += `<td>${cell}</td>`;
                    });
                    html += '</tr>';
                });

                html += '</tbody></table>';
                tableContainer.innerHTML = html;
            },

            // Review Modal
            openReviewModal() {
                const modal = document.getElementById('reviewModal');
                if (modal) {
                    modal.classList.add('active');
                    this.selectedRating = 0;
                    this.updateStarDisplay();
                }
            },

            closeReviewModal() {
                const modal = document.getElementById('reviewModal');
                if (modal) modal.classList.remove('active');

                // Reset form
                document.getElementById('reviewForm')?.reset();
                this.selectedRating = 0;
                this.updateStarDisplay();
            },

            setRating(rating) {
                this.selectedRating = rating;
                this.updateStarDisplay();
            },

            updateStarDisplay() {
                const stars = document.querySelectorAll('#starRatingInput .star');
                stars.forEach((star, index) => {
                    if (index < this.selectedRating) {
                        star.classList.add('active');
                    } else {
                        star.classList.remove('active');
                    }
                });
            },

            submitReview(e) {
                e.preventDefault();

                if (this.selectedRating === 0) {
                    alert('Please select a rating');
                    return;
                }

                const title = document.getElementById('reviewTitle').value;
                const text = document.getElementById('reviewText').value;
                const productId = this.selectedProduct?.id;

                if (!productId) return;

                // Initialize reviews array if doesn't exist
                if (!this.reviews[productId]) {
                    this.reviews[productId] = [];
                }

                // Add new review
                const newReview = {
                    author: this.user?.name || 'Guest',
                    rating: this.selectedRating,
                    title: title,
                    text: text,
                    date: 'Just now'
                };

                this.reviews[productId].unshift(newReview);

                // Re-render reviews
                this.renderReviews(productId);

                // Close modal
                this.closeReviewModal();

                // Show success message
                alert('Thank you for your review!');
            },


            updateDetailCartButtons(productId) {
                const isInCart = this.cart.some(item => item.id === productId);
                const initialAction = document.getElementById('cartInitialAction');
                const inAction = document.getElementById('cartInAction');

                if (isInCart) {
                    if (initialAction) initialAction.style.display = 'none';
                    if (inAction) inAction.classList.add('active');
                } else {
                    if (initialAction) initialAction.style.display = 'block';
                    if (inAction) inAction.classList.remove('active');
                }
            },

            closeProductDetail() {
                NavigationManager.pop();

                // If we came from search, reopen search overlay
                if (this.returnToSearch) {
                    setTimeout(() => {
                        const searchOverlay = document.getElementById('searchOverlay');
                        const searchInput = document.getElementById('searchInput');

                        if (searchOverlay && searchInput) {
                            searchOverlay.classList.add('active');
                            searchInput.value = this.lastSearchQuery || '';
                            this.handleSearch(this.lastSearchQuery || '');
                            searchInput.focus();
                        }

                        this.returnToSearch = false;
                        this.lastSearchQuery = '';
                    }, 100);
                }
            },

            selectSize(size) {
                this.selectedSize = size;
                document.querySelectorAll('.size-chip').forEach(c => c.classList.remove('active'));
                const chip = document.querySelector(`.size-chip[data-size="${size}"]`);
                if (chip) chip.classList.add('active');
            },

            addToCartFromDetail() {
                if (!this.selectedProduct) return;
                this.addToCart(this.selectedProduct.id);
                this.updateDetailCartButtons(this.selectedProduct.id);
            },

            removeFromCartFromDetail() {
                if (!this.selectedProduct) return;
                this.cart = this.cart.filter(item => item.id !== this.selectedProduct.id);
                this.updateCartUI();
                this.updateDetailCartButtons(this.selectedProduct.id);
            },

            openCartFromDetail() {
                // Don't close detail, just open cart overlay
                this.toggleCart();
            },

            addToCart(id) {
                const product = this.products.find(p => p.id === id);
                if (!product) return;
                const size = this.selectedSize || 'M';

                const existing = this.cart.find(c => c.id === id && c.size === size);
                if (existing) {
                    existing.quantity++;
                } else {
                    this.cart.push({ ...product, size: size, quantity: 1 });
                }
                this.updateCartUI();

                // Sync detail buttons if open
                const detail = document.getElementById('productDetail');
                if (detail && detail.classList.contains('active')) {
                    this.updateDetailCartButtons(id);
                }
            },

            buyNow() {
                this.addToCart();
                this.checkout();
            },

            toggleCart() {
                const sidebar = document.getElementById('cartSidebar');
                const overlay = document.getElementById('cartOverlay');
                const isActive = sidebar.classList.contains('active');

                if (isActive) {
                    sidebar.classList.remove('active');
                    overlay.classList.remove('active');
                } else {
                    // Close other overlays first
                    document.getElementById('searchOverlay')?.classList.remove('active');

                    sidebar.classList.add('active');
                    overlay.classList.add('active');
                }
            },

            updateCartUI() {
                const cartItems = document.getElementById('cartItems');

                // Calculate totals
                const totalItems = this.cart.reduce((sum, item) => sum + item.quantity, 0);
                const subtotal = this.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

                // Update Badges and Counts
                const badge = document.getElementById('cartBadge');
                if (badge) badge.textContent = totalItems;

                const headerCount = document.getElementById('cartCountHeader');
                if (headerCount) headerCount.textContent = `${totalItems} item${totalItems !== 1 ? 's' : ''}`;

                // Update Price
                const totalEl = document.getElementById('cartTotal');
                if (totalEl) totalEl.textContent = '' + subtotal.toLocaleString('en-IN');

                // Update Items
                if (this.cart.length === 0) {
                    cartItems.innerHTML = `
                        <div class="empty-cart" style="display:flex; flex-direction:column; align-items:center; justify-content:center; height:100%; opacity:0.6;">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" style="width:64px; height:64px; margin-bottom:16px;">
                                <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/>
                                <line x1="3" y1="6" x2="21" y2="6"/>
                            </svg>
                            <h3 style="font-family:'Playfair Display'; font-size:24px; margin-bottom:8px">Your bag is empty</h3>
                            <p style="font-size:14px">Time to fill it with elegance.</p>
                        </div>
                    `;
                } else {
                    cartItems.innerHTML = this.cart.map((item, idx) => `
                        <div class="cart-item">
                            <img src="${item.image}" class="cart-item-image" alt="${item.name}">
                            <div class="cart-item-details">
                                <div>
                                    <div class="cart-item-name">${item.name}</div>
                                    <div class="cart-item-meta">
                                        <span>Size: ${item.size}</span>
                                        <span style="width:1px; background:#ccc"></span>
                                        <span>${item.fabric}</span>
                                    </div>
                                    <div class="cart-item-price">${item.price.toLocaleString('en-IN')}</div>
                                </div>
                                <div class="cart-item-actions">
                                    <div class="qty-stepper">
                                        <button class="qty-btn-mini" onclick="App.updateCartItemQty(${idx}, -1)"></button>
                                        <div class="qty-val-mini">${item.quantity}</div>
                                        <button class="qty-btn-mini" onclick="App.updateCartItemQty(${idx}, 1)">+</button>
                                    </div>
                                    <button class="remove-btn" onclick="App.removeFromCart(${idx})">Remove</button>
                                </div>
                            </div>
                        </div>
                    `).join('');
                }
            },

            updateCartItemQty(idx, delta) {
                if (this.cart[idx]) {
                    const newQty = this.cart[idx].quantity + delta;
                    if (newQty < 1) {
                        // Optional: confirm removal if going to 0? For now just stay at 1 or remove logic can be handled by remove button
                        if (confirm('Remove item from cart?')) {
                            this.removeFromCart(idx);
                        }
                    } else {
                        this.cart[idx].quantity = newQty;
                        this.updateCartUI();
                    }
                }
            },

            removeFromCart(idx) {
                this.cart.splice(idx, 1);
                this.updateCartUI();
            },

            checkout() {
                if (this.cart.length === 0) {
                    alert('Your bag is empty!');
                    return;
                }

                // Close cart overlay
                NavigationManager.closeAllOverlays();

                // Update checkout UI
                const summary = document.getElementById('checkoutSummary');
                summary.innerHTML = this.cart.map(c => `
                    <div style="display:flex; justify-content:space-between; margin-bottom:8px; font-size:14px">
                        <span>${c.name} (${c.size}) x${c.quantity}</span>
                        <span style="font-weight:600">${(c.price * c.quantity).toLocaleString('en-IN')}</span>
                    </div>
                `).join('');

                const total = this.cart.reduce((sum, c) => sum + c.price * c.quantity, 0);
                document.getElementById('checkoutTotal').textContent = `${total.toLocaleString('en-IN')}`;

                NavigationManager.push('checkoutScreen');
            },

            closeCheckout() {
                NavigationManager.pop();
            },

            togglePassword(id) {
                const input = document.getElementById(id);
                if (input.type === 'password') {
                    input.type = 'text';
                    input.nextElementSibling.nextElementSibling.innerHTML = `<svg viewBox="0 0 24 24" width="20" height="20" stroke="currentColor" fill="none" class="eye-icon"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line></svg>`;
                } else {
                    input.type = 'password';
                    input.nextElementSibling.nextElementSibling.innerHTML = `<svg viewBox="0 0 24 24" width="20" height="20" stroke="currentColor" fill="none" class="eye-icon"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>`;
                }
            },

            selectPayment(method) {
                document.querySelectorAll('.payment-method').forEach(m => m.classList.remove('active'));
                event.currentTarget.classList.add('active');
                document.getElementById('upiInput').classList.toggle('active', method === 'upi');
            },

            processPayment() {
                const modal = document.getElementById('paymentModal');
                const icon = document.getElementById('paymentStatusIcon');
                const title = document.getElementById('paymentStatusTitle');
                const desc = document.getElementById('paymentStatusDesc');
                const btn = document.getElementById('paymentDoneBtn');

                icon.className = 'payment-status-icon processing';
                icon.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" style="animation:spin 1s linear infinite"><path d="M21 12a9 9 0 1 1-6.219-8.56"></path></svg>';
                title.textContent = 'Processing Payment';
                desc.textContent = 'Opening your payment app...';
                btn.classList.add('hidden');

                // Add a cancel button for failure state simulation
                let cancelBtn = document.getElementById('paymentCancelBtn');
                if (!cancelBtn) {
                    cancelBtn = document.createElement('button');
                    cancelBtn.id = 'paymentCancelBtn';
                    cancelBtn.className = 'btn ripple';
                    cancelBtn.style.background = 'var(--bg-secondary)';
                    cancelBtn.style.color = 'var(--text-secondary)';
                    cancelBtn.style.marginTop = '12px';
                    cancelBtn.textContent = 'Cancel Payment';
                    cancelBtn.onclick = () => App.cancelPayment();
                    document.querySelector('.payment-modal-content').appendChild(cancelBtn);
                }
                cancelBtn.classList.remove('hidden');

                modal.classList.add('active');

                // Simulate handoff delay then success
                this.paymentTimer = setTimeout(() => {
                    cancelBtn.classList.add('hidden');
                    icon.className = 'payment-status-icon success';
                    icon.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3"><polyline points="20 6 9 17 4 12"></polyline></svg>';
                    title.textContent = 'Payment Handoff Complete';
                    desc.textContent = 'Please confirm the transaction in your app and send us the details.';
                    btn.classList.remove('hidden');
                }, 3000);
            },

            cancelPayment() {
                clearTimeout(this.paymentTimer);
                const icon = document.getElementById('paymentStatusIcon');
                const title = document.getElementById('paymentStatusTitle');
                const desc = document.getElementById('paymentStatusDesc');
                const cancelBtn = document.getElementById('paymentCancelBtn');

                icon.className = 'payment-status-icon error';
                icon.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="var(--rose-500)" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>';
                icon.style.borderColor = 'var(--rose-500)';
                title.textContent = 'Payment Failed';
                desc.textContent = 'The transaction was cancelled or timed out. Please try again.';

                cancelBtn.textContent = 'Close';
                cancelBtn.onclick = () => App.closePaymentModal();
            },

            confirmOrder() {
                // Gather details
                const inputs = document.querySelectorAll('.checkout-content input');
                const name = inputs[0].value;
                const addr = inputs[1].value;
                const city = inputs[2].value;
                const phone = inputs[3].value;

                const items = this.cart.map(c => `- ${c.name} (${c.size}) x${c.qty}`).join('%0A');
                const total = this.cart.reduce((sum, c) => sum + c.price * c.qty, 0);

                const msg = `*New Order Request*%0A%0A*Customer:* ${name}%0A*Phone:* ${phone}%0A*Address:* ${addr}, ${city}%0A%0A*Items:*%0A${items}%0A%0A*Total Amount:* ${total.toLocaleString('en-IN')}%0A%0A*Payment Mode:* Manual Transfer (to 9789252705)`;

                // Save to internal state
                this.orders.push({
                    id: '#' + Math.random().toString(36).substr(2, 9).toUpperCase(),
                    date: new Date().toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' }),
                    total: total,
                    status: 'Processing',
                    items: this.cart.map(c => c.name).join(', ')
                });

                // Update Profile UI just in case
                this.updateProfileUI();

                this.closePaymentModal();
            },

            closePaymentModal() {
                document.getElementById('paymentModal').classList.remove('active');
                document.getElementById('checkoutScreen').classList.remove('active');
                this.cart = [];
                this.updateCartUI();
            },

            showProfile() {
                this.updateProfileUI();
                NavigationManager.push('profileScreen');
            },

            openDashboardModal(title, content) {
                const modal = document.getElementById('dashboardModal');
                const titleEl = document.getElementById('dashboardModalTitle');
                const bodyEl = document.getElementById('dashboardModalBody');
                if (!modal || !titleEl || !bodyEl) return;

                titleEl.textContent = title;
                bodyEl.innerHTML = content;
                modal.classList.add('active');
            },

            closeDashboardModal() {
                const modal = document.getElementById('dashboardModal');
                if (modal) modal.classList.remove('active');
            },

            closeProfile() {
                document.getElementById('profileScreen').classList.remove('active');
            },

            logout() {
                this.user = null;
                this.cart = [];
                this.wishlist = [];
                this.orders = [];

                NavigationManager.closeAllOverlays();
                NavigationManager.reset('intro');

                // Restart intro animation
                const intro = document.getElementById('intro');
                intro.classList.remove('active');
                void intro.offsetWidth; // Force reflow
                intro.classList.add('active');

                setTimeout(() => NavigationManager.replace('gateway'), 3500);

                this.toggleAdminUI(false);
            },

            clearCategoryFilter() {
                this.currentCategoryFilter = null;
                const badge = document.getElementById('searchCategoryBadge');
                if (badge) badge.classList.remove('active');

                const searchInput = document.getElementById('searchInput');
                if (searchInput) {
                    searchInput.placeholder = 'Search sarees, kurtis, silk...';
                    this.handleSearch(searchInput.value);
                }
            },

            toggleSearch() {
                const searchOverlay = document.getElementById('searchOverlay');
                const isActive = searchOverlay.classList.contains('active');

                if (isActive) {
                    searchOverlay.classList.remove('active');
                    // Clear category filter when closing search from global context
                    if (NavigationManager.getCurrentScreen() !== 'categoryDetailScreen') {
                        this.currentCategoryFilter = null;
                    }
                } else {
                    // Close other overlays first
                    NavigationManager.closeAllOverlays();

                    // Set category filter if we're in a category view
                    const currentScreen = NavigationManager.getCurrentScreen();
                    if (currentScreen === 'categoryDetailScreen') {
                        // Category filter already set by openCategory
                        // Update search placeholder
                        const searchInput = document.getElementById('searchInput');
                        if (searchInput) {
                            const categoryName = document.getElementById('categoryDetailTitle')?.textContent || 'this category';
                            searchInput.placeholder = `Search in ${categoryName}...`;
                        }
                    } else {
                        this.currentCategoryFilter = null;
                        const searchInput = document.getElementById('searchInput');
                        if (searchInput) {
                            searchInput.placeholder = 'Search sarees, kurtis, silk...';
                        }
                    }

                    searchOverlay.classList.add('active');
                    const badge = document.getElementById('searchCategoryBadge');
                    const badgeText = document.getElementById('categoryBadgeText');

                    if (currentScreen === 'categoryDetailScreen' && this.currentCategoryFilter) {
                        if (badge) {
                            badge.classList.add('active');
                            const categoryName = document.getElementById('categoryDetailTitle')?.textContent || 'this category';
                            if (badgeText) badgeText.textContent = `Searching in: ${categoryName}`;
                        }
                    } else {
                        if (badge) badge.classList.remove('active');
                    }

                    const input = document.getElementById('searchInput');
                    input.value = '';
                    this.handleSearch('');
                    setTimeout(() => input.focus(), 300);
                }
            },

            handleSearch(query) {
                const resultsContainer = document.getElementById('searchResults');

                if (!query.trim()) {
                    resultsContainer.innerHTML = `
                        <div class="search-empty">
                            <div class="search-empty-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="var(--purple-300)" stroke-width="1.5" width="48" height="48">
                                    <circle cx="11" cy="11" r="8"></circle>
                                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                                </svg>
                            </div>
                            <p>Start typing to search ${this.currentCategoryFilter ? 'in this category' : 'for your favorites'}</p>
                        </div>
                    `;
                    return;
                }

                // Filter products based on search query
                let filtered = this.products.filter(p =>
                    p.name.toLowerCase().includes(query.toLowerCase()) ||
                    p.category.toLowerCase().includes(query.toLowerCase()) ||
                    p.fabric.toLowerCase().includes(query.toLowerCase())
                );

                // If we're in a category view, filter by that category
                if (this.currentCategoryFilter) {
                    filtered = filtered.filter(p =>
                        p.category === this.currentCategoryFilter ||
                        p.fabric === this.currentCategoryFilter ||
                        (p.occasion && p.occasion === this.currentCategoryFilter)
                    );
                }

                if (filtered.length === 0) {
                    resultsContainer.innerHTML = `
                        <div class="search-empty">
                            <div class="search-empty-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="var(--purple-300)" stroke-width="1.5" width="48" height="48">
                                    <path d="M20.38 3.4a2 2 0 0 0-2 0l-2.43 1.21a2 2 0 0 1-1.9 0l-2.43-1.2h0a2 2 0 0 0-1.9 0l-2.43 1.2h0a2 2 0 0 1-1.9 0L3 3.4"></path>
                                    <path d="M12 12v10"></path>
                                    <path d="M12 12h-3"></path>
                                    <path d="M12 12h3"></path>
                                    <path d="M3 3.4v17.2a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V3.4"></path>
                                </svg>
                            </div>
                            <p>No products found ${this.currentCategoryFilter ? 'in this category ' : ''}for "${query}"</p>
                        </div>
                    `;
                    return;
                }

                resultsContainer.innerHTML = filtered.map((p, idx) => `
                    <div class="product-card" style="--idx: ${idx}" onclick="App.showProductFromSearch(${p.id})">
                        <div class="product-img">
                            <img src="${p.image}" alt="${p.name}">
                            <button class="wishlist-btn ${this.wishlist.includes(p.id) ? 'active' : ''}" 
                                onclick="event.stopPropagation(); App.toggleWishlist(${p.id}); App.updateSearchResults('${query.replace(/'/g, "\\'")}')">
                                <svg viewBox="0 0 24 24">
                                    <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                                </svg>
                            </button>
                        </div>
                        <div class="product-info">
                            <div class="product-name">${p.name}</div>
                            <div class="product-price">
                                ${p.price.toLocaleString('en-IN')}
                                <span class="product-original-price">${p.originalPrice.toLocaleString('en-IN')}</span>
                            </div>
                        </div>
                    </div>
                `).join('');
            },

            filterCategoryView(filter) {
                // Update active chip
                document.querySelectorAll('.filter-chip').forEach(chip => {
                    chip.classList.remove('active');
                    chip.style.background = 'white';
                    chip.style.color = 'var(--text-primary)';
                    chip.style.borderColor = '#e0e0e0';
                });

                const activeChip = document.querySelector(`.filter-chip[data-filter="${filter}"]`);
                if (activeChip) {
                    activeChip.classList.add('active');
                    activeChip.style.background = 'var(--purple-500)';
                    activeChip.style.color = 'white';
                    activeChip.style.borderColor = 'var(--purple-500)';
                }

                // Navigate to home and apply filter
                this.filterCategory(filter);
                this.switchNav('home');
            },

            toggleWishlistDetail() {
                if (!this.selectedProduct) return;
                this.toggleWishlist(this.selectedProduct.id);
                const btn = document.querySelector('#productDetail .wishlist-btn');
                btn.classList.toggle('active', this.wishlist.includes(this.selectedProduct.id));
            },

            showAddProduct() {
                NavigationManager.push('addProductScreen');
            },

            closeAddProduct() {
                NavigationManager.pop();
                document.getElementById('addProductForm').reset();
                document.getElementById('imagePreview').style.display = 'none';
                document.getElementById('uploadPlaceholder').style.display = 'block';
            },

            handleAddProduct(e) {
                e.preventDefault();
                const form = e.target;

                const newProduct = {
                    id: Date.now(), // simple unique id
                    name: form.elements['prodName'].value,
                    price: Number(form.elements['prodPrice'].value),
                    originalPrice: Number(form.elements['prodOrigPrice'].value) || 0,
                    category: form.elements['prodCat'].value,
                    fabric: form.elements['prodFabric'].value,
                    description: form.elements['prodDesc'].value,
                    image: this.newProductImage || 'data:image/svg+xml,%3Csvg width="300" height="400" xmlns="http://www.w3.org/2000/svg"%3E%3Crect width="300" height="400" fill="%23ddd"/%3E%3Ctext x="50%25" y="50%25" text-anchor="middle" dy=".3em"%3ENo Image%3C/text%3E%3C/svg%3E'
                };

                this.products.unshift(newProduct); // Add to top
                this.renderProducts();
                alert('Product Added Successfully!');
                this.closeAddProduct();
                this.newProductImage = null;
            },

            closeProfile() {
                NavigationManager.pop();
            },

            // PREMIUM SLIDESHOW METHODS
            initSlider() {
                const slides = document.querySelectorAll('.slide');
                const dotsContainer = document.getElementById('sliderDots');
                if (!slides.length || !dotsContainer) return;

                dotsContainer.innerHTML = '';
                slides.forEach((_, idx) => {
                    const dot = document.createElement('div');
                    dot.className = `slider-dot ${idx === 0 ? 'active' : ''}`;
                    dot.onclick = () => this.goToSlide(idx);
                    dotsContainer.appendChild(dot);
                });

                this.currentSlide = 0;
                this.startAutoplay();
            },

            startAutoplay() {
                this.stopAutoplay();
                this.slideInterval = setInterval(() => this.nextSlide(), 5000);
            },

            stopAutoplay() {
                if (this.slideInterval) clearInterval(this.slideInterval);
            },

            goToSlide(n) {
                const slides = document.querySelectorAll('.slide');
                const dots = document.querySelectorAll('.slider-dot');
                if (!slides.length) return;

                slides[this.currentSlide].classList.remove('active');
                if (dots[this.currentSlide]) dots[this.currentSlide].classList.remove('active');

                this.currentSlide = (n + slides.length) % slides.length;

                slides[this.currentSlide].classList.add('active');
                if (dots[this.currentSlide]) dots[this.currentSlide].classList.add('active');

                this.startAutoplay();
            },

            nextSlide() { this.goToSlide(this.currentSlide + 1); },
            prevSlide() { this.goToSlide(this.currentSlide - 1); },

            showEditProfile() {
                const content = `
                    <div class="slide-next">
                        <form onsubmit="App.saveProfile(event)" id="editProfileForm">
                            <div class="form-group">
                                <input type="text" class="form-input" id="editName" value="${this.user?.name || ''}" placeholder=" " required>
                                <label class="form-label">Full Name</label>
                            </div>
                            <div class="form-group" style="margin-top:20px">
                                <input type="email" class="form-input" id="editEmail" value="${this.user?.email || ''}" placeholder=" " required>
                                <label class="form-label">Email</label>
                            </div>
                            <button type="submit" class="form-btn ripple" style="margin-top:32px; background:var(--purple-600); width:100%">Save Changes</button>
                        </form>
                    </div>
                `;
                this.openDashboardModal('Edit Profile', content);
            },

            saveProfile(e) {
                e.preventDefault();
                const name = document.getElementById('editName').value;
                const email = document.getElementById('editEmail').value;
                this.user = { ...this.user, name, email };
                this.updateProfileUI();

                const bodyEl = document.getElementById('dashboardModalBody');
                if (bodyEl) {
                    bodyEl.innerHTML = `
                        <div class="slide-prev" style="text-align:center; padding:20px">
                            <div style="width:56px; height:56px; background:var(--purple-100); color:var(--purple-600); border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 20px">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" style="width:28px"><polyline points="20 6 9 17 4 12"></polyline></svg>
                            </div>
                            <h3 class="heading">Updated!</h3>
                            <button class="btn ripple" style="margin-top:20px; background:var(--purple-600); color:white; width:100%" onclick="App.closeDashboardModal()">Done</button>
                        </div>
                    `;
                }
            },

            showOrders() {
                if (this.orders.length === 0) {
                    this.orders = [
                        { id: '#ORD-8821', date: '26 Dec 2024', total: 8999, status: 'Delivered', items: 'Royal Purple Silk Saree' },
                        { id: '#ORD-7732', date: '12 Nov 2024', total: 3499, status: 'Shipped', items: 'Teal Anarkali Kurti' }
                    ];
                    this.updateProfileUI();
                }

                const content = `
                    <div class="slide-next">
                        ${this.orders.map(o => `
                            <div style="background:rgba(124, 77, 255, 0.05); padding:16px; margin-bottom:12px; border-radius:12px; border:1px solid rgba(124, 77, 255, 0.1)">
                                <div style="display:flex; justify-content:space-between; margin-bottom:8px">
                                    <span style="font-weight:700; color:var(--purple-800)">${o.id}</span>
                                    <span style="font-size:10px; font-weight:700; text-transform:uppercase; padding:4px 8px; border-radius:6px; background:${o.status === 'Delivered' ? 'rgba(46, 125, 50, 0.1)' : 'rgba(239, 108, 0, 0.1)'}; color:${o.status === 'Delivered' ? '#2e7d32' : '#ef6c00'}">${o.status}</span>
                                </div>
                                <div style="font-size:14px; margin-bottom:4px">${o.items}</div>
                                <div style="display:flex; justify-content:space-between; align-items:center; margin-top:8px">
                                     <span style="font-size:12px; color:var(--text-muted)">${o.date}</span>
                                     <span style="font-weight:700">${o.total.toLocaleString('en-IN')}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                this.openDashboardModal('Order History', content);
            },

            showWishlistScreen() {
                const items = this.products.filter(p => this.wishlist.includes(p.id));
                let content = '';

                if (items.length === 0) {
                    content = `
                        <div class="slide-next" style="text-align:center; padding:20px">
                            <div style="font-size:40px; margin-bottom:12px"></div>
                            <h3>Empty Wishlist</h3>
                            <button class="btn ripple" style="margin-top:16px; background:var(--purple-600); color:white" onclick="App.closeDashboardModal(); App.closeProfile()">Browse Store</button>
                        </div>
                    `;
                } else {
                    content = `
                        <div class="wishlist-popup-grid" style="display:grid; grid-template-columns:1fr 1fr; gap:12px">
                            ${items.map(p => `
                                <div class="product-card" onclick="App.showProduct(${p.id}); App.closeDashboardModal()" style="padding:8px">
                                    <img src="${p.image}" style="width:100%; height:120px; object-fit:cover; border-radius:8px; margin-bottom:8px">
                                    <div style="font-weight:600; font-size:11px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis">${p.name}</div>
                                    <div style="font-weight:700; color:var(--purple-600); font-size:12px">${p.price.toLocaleString('en-IN')}</div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
                this.openDashboardModal('My Wishlist', content);
            },

            showSettings() {
                NavigationManager.push('settingsScreen');
            },

            deleteProduct(id) {
                if (!confirm('Are you sure you want to delete this product?')) return;
                this.products = this.products.filter(p => p.id !== id);
                this.renderProducts();
            },
            showProductFromSearch(id) {
                // Store that we came from search
                this.returnToSearch = true;
                this.lastSearchQuery = document.getElementById('searchInput')?.value || '';

                // Close search overlay
                const searchOverlay = document.getElementById('searchOverlay');
                if (searchOverlay) {
                    searchOverlay.classList.remove('active');
                }
                // Show product
                this.showProduct(id);
            },
            updateSearchResults(query) {
                // Re-render search results to update wishlist states
                this.handleSearch(query);
            },
            handleImageUpload(input) {
                if (input.files && input.files[0]) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        this.newProductImage = e.target.result;
                        const img = document.getElementById('imagePreview');
                        img.src = e.target.result;
                        img.style.display = 'block';
                        document.getElementById('uploadPlaceholder').style.display = 'none';
                    };
                    reader.readAsDataURL(input.files[0]);
                }
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            // Initialize particles, scroll navbar, and animations
            // Create floating particles
            const particlesContainer = document.getElementById('particles');
            if (particlesContainer) {
                const particleCount = 30;

                for (let i = 0; i < particleCount; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = Math.random() * 100 + '%';
                    particle.style.animationDelay = Math.random() * 20 + 's';
                    particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                    particlesContainer.appendChild(particle);
                }
            }

            // Scroll-aware bottom navbar
            let lastScrollY = 0;
            let ticking = false;

            function updateNavbar() {
                const currentScrollY = window.scrollY;

                if (currentScrollY > lastScrollY && currentScrollY > 100) {
                    if (bottomNav) bottomNav.classList.add('nav-hidden');
                } else {
                    if (bottomNav) bottomNav.classList.remove('nav-hidden');
                }

                lastScrollY = currentScrollY;
                ticking = false;
            }

            function requestNavbarUpdate() {
                if (!ticking) {
                    window.requestAnimationFrame(updateNavbar);
                    ticking = true;
                }
            }

            window.addEventListener('scroll', requestNavbarUpdate, { passive: true });

            // Scroll-triggered fade-in animations
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };

            const fadeInObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                    }
                });
            }, observerOptions);

            // Observe sections for fade-in effect
            setTimeout(() => {
                const sections = document.querySelectorAll('.section');
                sections.forEach(section => {
                    section.classList.add('fade-in-view');
                    fadeInObserver.observe(section);
                });
            }, 1000);

            // iOS 26 Liquid Glass Navbar - Hide on scroll, show on stop
            let scrollTimeout;
            let isScrolling = false;
            const bottomNav = document.querySelector('.bottom-nav');

            function handleScroll() {
                // Hide navbar immediately when scrolling starts
                if (bottomNav && !isScrolling) {
                    isScrolling = true;
                    bottomNav.classList.add('nav-hidden');
                }

                // Clear previous timeout
                clearTimeout(scrollTimeout);

                // Show navbar after scrolling stops (300ms delay for iOS feel)
                scrollTimeout = setTimeout(() => {
                    if (bottomNav && isScrolling) {
                        isScrolling = false;
                        bottomNav.classList.remove('nav-hidden');
                    }
                }, 300);
            }

            window.addEventListener('scroll', handleScroll, { passive: true });

            // Initialize main app
            App.init();
        });
    </script>

</body>

</html>
